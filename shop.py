import asyncio
import logging
import sys
from aiogram import Bot, Dispatcher, F, types
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode
from aiogram.filters import CommandStart, Command
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, FSInputFile
from aiogram.exceptions import TelegramBadRequest, TelegramForbiddenError, TelegramAPIError
import json
import os
import re

# --- PERSISTENCE ---
SHOP_USERS_FILE = "shop_users.json"
PROMOCODES_FILE = "promocodes.json"
WORKER_DATA_FILE = "worker_data.json"
shop_users = {}
promocodes = {}
worker_data = {"startcode_amount": 100, "purchases": []}

def load_data():
    global shop_users, promocodes, worker_data
    if os.path.exists(SHOP_USERS_FILE):
        with open(SHOP_USERS_FILE, "r", encoding="utf-8") as f:
            try:
                shop_users = json.load(f)
            except:
                shop_users = {}
    else:
        shop_users = {}

    if os.path.exists(PROMOCODES_FILE):
        with open(PROMOCODES_FILE, "r", encoding="utf-8") as f:
            try:
                promocodes = json.load(f)
            except:
                promocodes = {}
    else:
        promocodes = {}
    
    if os.path.exists(WORKER_DATA_FILE):
        with open(WORKER_DATA_FILE, "r", encoding="utf-8") as f:
            try:
                worker_data = json.load(f)
            except:
                worker_data = {"startcode_amount": 100, "purchases": []}
    else:
        worker_data = {"startcode_amount": 100, "purchases": []}

def save_shop_users():
    with open(SHOP_USERS_FILE, "w", encoding="utf-8") as f:
        json.dump(shop_users, f, indent=4, ensure_ascii=False)

def save_promocodes():
    with open(PROMOCODES_FILE, "w", encoding="utf-8") as f:
        json.dump(promocodes, f, indent=4, ensure_ascii=False)

def save_worker_data():
    with open(WORKER_DATA_FILE, "w", encoding="utf-8") as f:
        json.dump(worker_data, f, indent=4, ensure_ascii=False)

# --- WORKER NOTIFICATIONS ---
async def notify_worker_mammoth_blocked(mammoth_id: str, mammoth_username: str = None):
    """–£–≤–µ–¥–æ–º–ª—è–µ—Ç –≤–æ—Ä–∫–µ—Ä–∞, —á—Ç–æ –µ–≥–æ –º–∞–º–æ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞"""
    load_data()
    mammoth_data = shop_users.get(mammoth_id)
    if not mammoth_data:
        return
    
    worker_id = mammoth_data.get("referrer_id")
    if not worker_id or not bot:
        return
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º username –∏–∑ –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω
        if not mammoth_username:
            mammoth_username = mammoth_data.get("username")
        username_text = f"@{mammoth_username}" if mammoth_username else f"ID: {mammoth_id}"
        text = (
            f"üö´ <b>–ú–∞–º–æ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞</b>\n\n"
            f"ü¶£ –ú–∞–º–æ–Ω—Ç: {username_text}\n"
            f"üìã ID: <code>{mammoth_id}</code>\n\n"
            f"‚ö†Ô∏è –ú–∞–º–æ–Ω—Ç –∫–∏–Ω—É–ª –±–æ—Ç–∞ –≤ —á—Å"
        )
        await bot.send_message(chat_id=worker_id, text=text, parse_mode='HTML')
    except Exception as e:
        logging.error(f"Failed to notify worker about blocked mammoth: {e}")

async def notify_worker_balance_topup(mammoth_id: str, amount: int, mammoth_username: str = None):
    """–£–≤–µ–¥–æ–º–ª—è–µ—Ç –≤–æ—Ä–∫–µ—Ä–∞ –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ –º–∞–º–æ–Ω—Ç–æ–º"""
    load_data()
    mammoth_data = shop_users.get(mammoth_id)
    if not mammoth_data:
        return
    
    worker_id = mammoth_data.get("referrer_id")
    if not worker_id or not bot:
        return
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º username –∏–∑ –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω
        if not mammoth_username:
            mammoth_username = mammoth_data.get("username")
        username_text = f"@{mammoth_username}" if mammoth_username else f"ID: {mammoth_id}"
        text = (
            f"üí∞ <b>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</b>\n\n"
            f"ü¶£ –ú–∞–º–æ–Ω—Ç: {username_text}\n"
            f"üìã ID: <code>{mammoth_id}</code>\n"
            f"üíµ –°—É–º–º–∞: <b>{amount} ‚ÇΩ</b>\n\n"
            f"‚úÖ –ú–∞–º–æ–Ω—Ç —Ö–æ—á–µ—Ç –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"
        )
        await bot.send_message(chat_id=worker_id, text=text, parse_mode='HTML')
    except Exception as e:
        logging.error(f"Failed to notify worker about balance topup: {e}")

# Load data on startup
load_data()
load_security_data()

# --- CONFIGURATION ---
TOKEN = "8279864325:AAGjtvhDbB6JAGDqx3uXk-WijPmVazya6yM" 
ADMIN_ID = 8495992108

# --- SECURITY SETTINGS ---
WORKER_WHITELIST_FILE = "worker_whitelist.json"
SECURITY_LOG_FILE = "security_log.json"
MAX_BROADCAST_PER_HOUR = 5  # –ú–∞–∫—Å–∏–º—É–º —Ä–∞—Å—Å—ã–ª–æ–∫ –≤ —á–∞—Å –Ω–∞ –≤–æ—Ä–∫–µ—Ä–∞
MAX_MESSAGE_LENGTH = 2000  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
SPAM_KEYWORDS = ["botfucked", "–ø—Ä–æ–µ–±–∞–ª", "–≤–∑–ª–æ–º–∞–ª–∏", "hacked", "fucked"]  # –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞

# Whitelist –≤–æ—Ä–∫–µ—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ —ç—Ç–∏ ID –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å worker —Ñ—É–Ω–∫—Ü–∏–∏)
worker_whitelist = []
security_log = []

def load_security_data():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
    global worker_whitelist, security_log
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º whitelist –≤–æ—Ä–∫–µ—Ä–æ–≤
    if os.path.exists(WORKER_WHITELIST_FILE):
        with open(WORKER_WHITELIST_FILE, "r", encoding="utf-8") as f:
            try:
                worker_whitelist = json.load(f)
            except:
                worker_whitelist = []
    else:
        # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω
        worker_whitelist = [str(ADMIN_ID)]
        save_worker_whitelist()
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    if os.path.exists(SECURITY_LOG_FILE):
        with open(SECURITY_LOG_FILE, "r", encoding="utf-8") as f:
            try:
                security_log = json.load(f)
            except:
                security_log = []
    else:
        security_log = []

def save_worker_whitelist():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç whitelist –≤–æ—Ä–∫–µ—Ä–æ–≤"""
    with open(WORKER_WHITELIST_FILE, "w", encoding="utf-8") as f:
        json.dump(worker_whitelist, f, indent=4, ensure_ascii=False)

def save_security_log():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –ª–æ–≥–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 –∑–∞–ø–∏—Å–µ–π)
    if len(security_log) > 1000:
        security_log[:] = security_log[-1000:]
    
    with open(SECURITY_LOG_FILE, "w", encoding="utf-8") as f:
        json.dump(security_log, f, indent=4, ensure_ascii=False)

def log_security_event(event_type: str, user_id: str, username: str, details: str):
    """–õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
    from datetime import datetime
    log_entry = {
        "timestamp": datetime.now().isoformat(),
        "type": event_type,
        "user_id": str(user_id),
        "username": username,
        "details": details
    }
    security_log.append(log_entry)
    save_security_log()
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö
    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—É—é –∑–∞–¥–∞—á—É
    if event_type in ["UNAUTHORIZED_ACCESS", "SPAM_DETECTED", "RATE_LIMIT_EXCEEDED"]:
        try:
            if bot:
                # –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                notification_text = (
                    f"üö® <b>–°–û–ë–´–¢–ò–ï –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò</b>\n\n"
                    f"–¢–∏–ø: {event_type}\n"
                    f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @{username} (ID: {user_id})\n"
                    f"–î–µ—Ç–∞–ª–∏: {details}"
                )
                
                async def send_notification():
                    try:
                        await bot.send_message(
                            chat_id=ADMIN_ID,
                            text=notification_text,
                            parse_mode='HTML'
                        )
                    except Exception as e:
                        logging.error(f"Failed to send security notification: {e}")
                
                # –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                try:
                    loop = asyncio.get_event_loop()
                    if loop.is_running():
                        asyncio.create_task(send_notification())
                except RuntimeError:
                    # –ï—Å–ª–∏ event loop –Ω–µ –∑–∞–ø—É—â–µ–Ω, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
                    logging.warning("Cannot send security notification: event loop not running")
        except Exception as e:
            logging.error(f"Error in log_security_event notification: {e}")

def is_worker_authorized(user_id: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞–∫ –≤–æ—Ä–∫–µ—Ä"""
    user_id_str = str(user_id)
    # –ê–¥–º–∏–Ω –≤—Å–µ–≥–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    if int(user_id_str) == ADMIN_ID:
        return True
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º whitelist
    return user_id_str in worker_whitelist

def check_spam_content(text: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–ø–∞–º–∞"""
    if not text:
        return False
    text_lower = text.lower()
    for keyword in SPAM_KEYWORDS:
        if keyword in text_lower:
            return True
    return False

def check_rate_limit(user_id: str, action: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç rate limit –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π"""
    from datetime import datetime, timedelta
    user_id_str = str(user_id)
    now = datetime.now()
    hour_ago = now - timedelta(hours=1)
    
    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
    recent_actions = [
        entry for entry in security_log
        if entry.get("user_id") == user_id_str
        and entry.get("type") == action
        and datetime.fromisoformat(entry["timestamp"]) > hour_ago
    ]
    
    if action == "BROADCAST" and len(recent_actions) >= MAX_BROADCAST_PER_HOUR:
        return False
    return True

# --- BOT SETUP ---
from aiogram.fsm.storage.memory import MemoryStorage
dp = Dispatcher(storage=MemoryStorage())
bot = None

# --- SHOP DATA ---
# Structure: City -> Districts -> Categories -> Products
SHOP_DATA = {
    "–ú–æ—Å–∫–≤–∞": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π", "–¢–∞–≥–∞–Ω–∫–∞"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active", "–¢–∞–≥–∞–Ω–∫–∞": "active"},
    },
    "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥": {
        "districts": ["–ù–µ–≤—Å–∫–∏–π", "–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥–∫–∞", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π"],
        "coords": {"–ù–µ–≤—Å–∫–∏–π": "active", "–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥–∫–∞": "active", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active"}
    },
    "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π", "–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active", "–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active"}
    },
    "–ö–∞–∑–∞–Ω—å": {
        "districts": ["–í–∞—Ö–∏—Ç–æ–≤—Å–∫–∏–π", "–ü—Ä–∏–≤–æ–ª–∂—Å–∫–∏–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π"],
        "coords": {"–í–∞—Ö–∏—Ç–æ–≤—Å–∫–∏–π": "active", "–ü—Ä–∏–≤–æ–ª–∂—Å–∫–∏–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active"}
    },
    "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active"}
    },
    "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥": {
        "districts": ["–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∏–π", "–ö–∞–Ω–∞–≤–∏–Ω—Å–∫–∏–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π"],
        "coords": {"–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∏–π": "active", "–ö–∞–Ω–∞–≤–∏–Ω—Å–∫–∏–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active"}
    },
    "–ß–µ–ª—è–±–∏–Ω—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active"}
    },
    "–£—Ñ–∞": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–ö–∏—Ä–æ–≤—Å–∫–∏–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active"}
    },
    "–°–∞–º–∞—Ä–∞": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π": "active"}
    },
    "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É": {
        "districts": ["–í–æ—Ä–æ—à–∏–ª–æ–≤—Å–∫–∏–π", "–ö–∏—Ä–æ–≤—Å–∫–∏–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π"],
        "coords": {"–í–æ—Ä–æ—à–∏–ª–æ–≤—Å–∫–∏–π": "active", "–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ó–∞–ø–∞–¥–Ω—ã–π", "–ö–∞—Ä–∞—Å—É–Ω—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ó–∞–ø–∞–¥–Ω—ã–π": "active", "–ö–∞—Ä–∞—Å—É–Ω—Å–∫–∏–π": "active"}
    },
    "–û–º—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active"}
    },
    "–í–æ—Ä–æ–Ω–µ–∂": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–ö–æ–º–∏–Ω—Ç–µ—Ä–Ω–æ–≤—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–ö–æ–º–∏–Ω—Ç–µ—Ä–Ω–æ–≤—Å–∫–∏–π": "active"}
    },
    "–ü–µ—Ä–º—å": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∏–π", "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∏–π": "active", "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π": "active"}
    },
    "–í–æ–ª–≥–æ–≥—Ä–∞–¥": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π", "–ö–∏—Ä–æ–≤—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active"}
    },
    "–°–∞—Ä–∞—Ç–æ–≤": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π": "active"}
    },
    "–¢—é–º–µ–Ω—å": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–ò—Ä–∫—É—Ç—Å–∫": {
        "districts": ["–ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∏–π"],
        "coords": {"–ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∏–π": "active"}
    },
    "–ë–∞—Ä–Ω–∞—É–ª": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active"}
    },
    "–£–ª—å—è–Ω–æ–≤—Å–∫": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–ó–∞–≤–æ–ª–∂—Å–∫–∏–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–ó–∞–≤–æ–ª–∂—Å–∫–∏–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active"}
    },
    "–¢–æ–ª—å—è—Ç—Ç–∏": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∏–π", "–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∏–π": "active", "–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∏–π": "active"}
    },
    "–ò–∂–µ–≤—Å–∫": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π": "active"}
    },
    "–•–∞–±–∞—Ä–æ–≤—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ö–∏—Ä–æ–≤—Å–∫–∏–π", "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active", "–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π": "active"}
    },
    "–Ø—Ä–æ—Å–ª–∞–≤–ª—å": {
        "districts": ["–ö–∏—Ä–æ–≤—Å–∫–∏–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π"],
        "coords": {"–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π": "active"}
    },
    "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π", "–ü–µ—Ä–≤–æ—Ä–µ—á–µ–Ω—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π": "active", "–ü–µ—Ä–≤–æ—Ä–µ—á–µ–Ω—Å–∫–∏–π": "active"}
    },
    "–ú–∞—Ö–∞—á–∫–∞–ª–∞": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π", "–ö–∏—Ä–æ–≤—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active"}
    },
    "–¢–æ–º—Å–∫": {
        "districts": ["–ö–∏—Ä–æ–≤—Å–∫–∏–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π"],
        "coords": {"–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active"}
    },
    "–û—Ä–µ–Ω–±—É—Ä–≥": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–î–∑–µ—Ä–∂–∏–Ω—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–î–∑–µ—Ä–∂–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–ö–µ–º–µ—Ä–æ–≤–æ": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–†—É–¥–Ω–∏—á–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–†—É–¥–Ω–∏—á–Ω—ã–π": "active"}
    },
    "–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ö—É–π–±—ã—à–µ–≤—Å–∫–∏–π", "–û—Ä–¥–∂–æ–Ω–∏–∫–∏–¥–∑–µ–≤—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ö—É–π–±—ã—à–µ–≤—Å–∫–∏–π": "active", "–û—Ä–¥–∂–æ–Ω–∏–∫–∏–¥–∑–µ–≤—Å–∫–∏–π": "active"}
    },
    "–†—è–∑–∞–Ω—å": {
        "districts": ["–°–æ–≤–µ—Ç—Å–∫–∏–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π"],
        "coords": {"–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active"}
    },
    "–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π", "–ö–∏—Ä–æ–≤—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–ö–∏—Ä–æ–≤—Å–∫–∏–π": "active"}
    },
    "–ü–µ–Ω–∑–∞": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active"}
    },
    "–õ–∏–ø–µ—Ü–∫": {
        "districts": ["–õ–µ–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π", "–ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π"],
        "coords": {"–õ–µ–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π": "active", "–ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active"}
    },
    "–¢—É–ª–∞": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ü—Ä–∏–≤–æ–∫–∑–∞–ª—å–Ω—ã–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ü—Ä–∏–≤–æ–∫–∑–∞–ª—å–Ω—ã–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active"}
    },
    "–ö–∏—Ä–æ–≤": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ù–æ–≤–æ–≤—è—Ç—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ù–æ–≤–æ–≤—è—Ç—Å–∫–∏–π": "active"}
    },
    "–ß–µ–±–æ–∫—Å–∞—Ä—ã": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π": "active", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π": "active"}
    },
    "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∏–π", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∏–π": "active", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π": "active"}
    },
    "–ö—É—Ä—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–π–º—Å–∫–∏–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–π–º—Å–∫–∏–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active"}
    },
    "–£–ª–∞–Ω-–£–¥—ç": {
        "districts": ["–°–æ–≤–µ—Ç—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π"],
        "coords": {"–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active"}
    },
    "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π": "active"}
    },
    "–°–æ—á–∏": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ê–¥–ª–µ—Ä—Å–∫–∏–π", "–•–æ—Å—Ç–∏–Ω—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ê–¥–ª–µ—Ä—Å–∫–∏–π": "active", "–•–æ—Å—Ç–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π", "–û—Ä–¥–∂–æ–Ω–∏–∫–∏–¥–∑–µ–≤—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–ü—Ä–∞–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π": "active", "–û—Ä–¥–∂–æ–Ω–∏–∫–∏–¥–∑–µ–≤—Å–∫–∏–π": "active"}
    },
    "–¢–≤–µ—Ä—å": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π", "–ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π": "active", "–ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∏–π": "active"}
    },
    "–ò–≤–∞–Ω–æ–≤–æ": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∏–π": "active"}
    },
    "–ë—Ä—è–Ω—Å–∫": {
        "districts": ["–°–æ–≤–µ—Ç—Å–∫–∏–π", "–§–æ–∫–∏–Ω—Å–∫–∏–π", "–í–æ–ª–æ–¥–∞—Ä—Å–∫–∏–π"],
        "coords": {"–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–§–æ–∫–∏–Ω—Å–∫–∏–π": "active", "–í–æ–ª–æ–¥–∞—Ä—Å–∫–∏–π": "active"}
    },
    "–°—É—Ä–≥—É—Ç": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–í–æ—Å—Ç–æ—á–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–í–æ—Å—Ç–æ—á–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active"}
    },
    "–ù–∏–∂–Ω–∏–π –¢–∞–≥–∏–ª": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–î–∑–µ—Ä–∂–∏–Ω—Å–∫–∏–π", "–¢–∞–≥–∏–ª—Å—Ç—Ä–æ–µ–≤—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–î–∑–µ—Ä–∂–∏–Ω—Å–∫–∏–π": "active", "–¢–∞–≥–∏–ª—Å—Ç—Ä–æ–µ–≤—Å–∫–∏–π": "active"}
    },
    "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫": {
        "districts": ["–õ–æ–º–æ–Ω–æ—Å–æ–≤—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–°–µ–≤–µ—Ä–Ω—ã–π"],
        "coords": {"–õ–æ–º–æ–Ω–æ—Å–æ–≤—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active"}
    },
    "–ß–∏—Ç–∞": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π", "–ò–Ω–≥–æ–¥–∏–Ω—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active", "–ò–Ω–≥–æ–¥–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–°–º–æ–ª–µ–Ω—Å–∫": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π", "–ó–∞–¥–Ω–µ–ø—Ä–æ–≤—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π": "active", "–ó–∞–¥–Ω–µ–ø—Ä–æ–≤—Å–∫–∏–π": "active"}
    },
    "–ö–∞–ª—É–≥–∞": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π": "active"}
    },
    "–í–ª–∞–¥–∏–∫–∞–≤–∫–∞–∑": {
        "districts": ["–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–ò—Ä–∏—Å—Ç–æ–Ω—Å–∫–∏–π"],
        "coords": {"–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–ò—Ä–∏—Å—Ç–æ–Ω—Å–∫–∏–π": "active"}
    },
    "–ß–µ—Ä–µ–ø–æ–≤–µ—Ü": {
        "districts": ["–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–ó–∞—à–µ–∫—Å–Ω–∏–Ω—Å–∫–∏–π"],
        "coords": {"–ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–ó–∞—à–µ–∫—Å–Ω–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–í–æ–ª–∂—Å–∫–∏–π": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–°—Ç–µ—Ä–ª–∏—Ç–∞–º–∞–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–í–æ—Å—Ç–æ—á–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–í–æ—Å—Ç–æ—á–Ω—ã–π": "active"}
    },
    "–ì—Ä–æ–∑–Ω—ã–π": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ó–∞–≤–æ–¥—Å–∫–æ–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ó–∞–≤–æ–¥—Å–∫–æ–π": "active"}
    },
    "–Ø–∫—É—Ç—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ê–≤—Ç–æ–¥–æ—Ä–æ–∂–Ω—ã–π", "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ê–≤—Ç–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active", "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π": "active"}
    },
    "–ü–æ–¥–æ–ª—å—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ö–ª–∏–º–æ–≤—Å–∫", "–ù–æ–≤–æ-–°—ã—Ä–æ–≤–æ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ö–ª–∏–º–æ–≤—Å–∫": "active", "–ù–æ–≤–æ-–°—ã—Ä–æ–≤–æ": "active"}
    },
    "–¢–∞–º–±–æ–≤": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–°–æ–≤–µ—Ç—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–°–æ–≤–µ—Ç—Å–∫–∏–π": "active"}
    },
    "–°—Ç–∞—Ä—ã–π –û—Å–∫–æ–ª": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ—á–Ω—ã–π", "–Æ–≥–æ-–ó–∞–ø–∞–¥–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ—á–Ω—ã–π": "active", "–Æ–≥–æ-–ó–∞–ø–∞–¥–Ω—ã–π": "active"}
    },
    "–ì–µ–ª–µ–Ω–¥–∂–∏–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ê–Ω–∞–ø–∞": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–í–∏—Ç—è–∑–µ–≤–æ", "–î–∂–µ–º–µ—Ç–µ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–í–∏—Ç—è–∑–µ–≤–æ": "active", "–î–∂–µ–º–µ—Ç–µ": "active"}
    },
    "–ë–µ–ª–≥–æ—Ä–æ–¥": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–í–æ—Å—Ç–æ—á–Ω—ã–π", "–ó–∞–ø–∞–¥–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–í–æ—Å—Ç–æ—á–Ω—ã–π": "active", "–ó–∞–ø–∞–¥–Ω—ã–π": "active"}
    },
    "–ö—É—Ä–≥–∞–Ω": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ó–∞–ø–∞–¥–Ω—ã–π", "–í–æ—Å—Ç–æ—á–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ó–∞–ø–∞–¥–Ω—ã–π": "active", "–í–æ—Å—Ç–æ—á–Ω—ã–π": "active"}
    },
    "–û—Ä—ë–ª": {
        "districts": ["–°–æ–≤–µ—Ç—Å–∫–∏–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π"],
        "coords": {"–°–æ–≤–µ—Ç—Å–∫–∏–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active"}
    },
    "–°—ã–∫—Ç—ã–≤–∫–∞—Ä": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–≠–∂–≤–∏–Ω—Å–∫–∏–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–≠–∂–≤–∏–Ω—Å–∫–∏–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ü–µ—Ç—Ä–æ–∑–∞–≤–æ–¥—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ü–µ—Ä–µ–≤–∞–ª–∫–∞"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ü–µ—Ä–µ–≤–∞–ª–∫–∞": "active"}
    },
    "–ù–∞–ª—å—á–∏–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ò—Å–ø—Ä–∞–≤–Ω—ã–π", "–°—Ç—Ä–µ–ª–∫–∞"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ò—Å–ø—Ä–∞–≤–Ω—ã–π": "active", "–°—Ç—Ä–µ–ª–∫–∞": "active"}
    },
    "–•–∞—Å–∞–≤—é—Ä—Ç": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–í–æ—Å—Ç–æ—á–Ω—ã–π", "–ó–∞–ø–∞–¥–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–í–æ—Å—Ç–æ—á–Ω—ã–π": "active", "–ó–∞–ø–∞–¥–Ω—ã–π": "active"}
    },
    "–ë–∞–ª–∞—à–∏—Ö–∞": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π", "–°–∞–ª—Ç—ã–∫–æ–≤–∫–∞"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": "active", "–°–∞–ª—Ç—ã–∫–æ–≤–∫–∞": "active"}
    },
    "–•–∏–º–∫–∏": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π", "–ü–ª–∞–Ω–µ—Ä–Ω–∞—è"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π": "active", "–ü–ª–∞–Ω–µ—Ä–Ω–∞—è": "active"}
    },
    "–ú—ã—Ç–∏—â–∏": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ü–∏—Ä–æ–≥–æ–≤—Å–∫–∏–π", "–ú–∞—Ä—Ñ–∏–Ω–æ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ü–∏—Ä–æ–≥–æ–≤—Å–∫–∏–π": "active", "–ú–∞—Ä—Ñ–∏–Ω–æ": "active"}
    },
    "–ö–æ—Ä–æ–ª—ë–≤": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–Æ–±–∏–ª–µ–π–Ω—ã–π", "–ö–æ—Å—Ç–∏–Ω–æ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–Æ–±–∏–ª–µ–π–Ω—ã–π": "active", "–ö–æ—Å—Ç–∏–Ω–æ": "active"}
    },
    "–õ—é–±–µ—Ä—Ü—ã": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ö—Ä–∞—Å–Ω–∞—è –ì–æ—Ä–∫–∞"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ö—Ä–∞—Å–Ω–∞—è –ì–æ—Ä–∫–∞": "active"}
    },
    "–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ö–æ–ª–æ–º–Ω–∞": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–©—É—Ä–æ–≤–æ", "–ö–æ–ª—ã—á—ë–≤–æ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–©—É—Ä–æ–≤–æ": "active", "–ö–æ–ª—ã—á—ë–≤–æ": "active"}
    },
    "–ú—É—Ä–º–∞–Ω—Å–∫": {
        "districts": ["–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π", "–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∏–π"],
        "coords": {"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active", "–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∏–π": "active"}
    },
    "–ù–æ—Ä–∏–ª—å—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–¢–∞–ª–Ω–∞—Ö", "–ö–∞–π–µ—Ä–∫–∞–Ω"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–¢–∞–ª–Ω–∞—Ö": "active", "–ö–∞–π–µ—Ä–∫–∞–Ω": "active"}
    },
    "–ü—Å–∫–æ–≤": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ó–∞–≤–µ–ª–∏—á—å–µ", "–ó–∞–ø—Å–∫–æ–≤—å–µ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ó–∞–≤–µ–ª–∏—á—å–µ": "active", "–ó–∞–ø—Å–∫–æ–≤—å–µ": "active"}
    },
    "–í–µ–ª–∏–∫–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–æ—Ñ–∏–π—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞", "–¢–æ—Ä–≥–æ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–æ—Ñ–∏–π—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞": "active", "–¢–æ—Ä–≥–æ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞": "active"}
    },
    "–ö–æ—Å—Ç—Ä–æ–º–∞": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–§–∞–±—Ä–∏—á–Ω—ã–π", "–ó–∞–≤–æ–ª–∂—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–§–∞–±—Ä–∏—á–Ω—ã–π": "active", "–ó–∞–≤–æ–ª–∂—Å–∫–∏–π": "active"}
    },
    "–í–µ–ª–∏–∫–∏–µ –õ—É–∫–∏": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–ö–∞–º—á–∞—Ç—Å–∫–∏–π": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫", "–ï–ª–∏–∑–æ–≤–æ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫": "active", "–ï–ª–∏–∑–æ–≤–æ": "active"}
    },
    "–ë–ª–∞–≥–æ–≤–µ—â–µ–Ω—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active", "–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": "active"}
    },
    "–ú–∞–≥–∞–¥–∞–Ω": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ù–∞–∑—Ä–∞–Ω—å": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ê–ª—Ö–∞–Ω—á—É—Ä—Ç", "–ì–∞–º—É—Ä–∑–∏–µ–≤—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ê–ª—Ö–∞–Ω—á—É—Ä—Ç": "active", "–ì–∞–º—É—Ä–∑–∏–µ–≤—Å–∫–∏–π": "active"}
    },
    "–ù–æ–≤–æ—á–µ–±–æ–∫—Å–∞—Ä—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–í–æ—Å—Ç–æ—á–Ω—ã–π", "–ó–∞–ø–∞–¥–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–í–æ—Å—Ç–æ—á–Ω—ã–π": "active", "–ó–∞–ø–∞–¥–Ω—ã–π": "active"}
    },
    "–°–∞–ª–∞–≤–∞—Ç": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ù–∏–∂–Ω–µ–∫–∞–º—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°—Ç–∞—Ä—ã–π –≥–æ—Ä–æ–¥", "–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°—Ç–∞—Ä—ã–π –≥–æ—Ä–æ–¥": "active", "–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥": "active"}
    },
    "–ê–ª—å–º–µ—Ç—å–µ–≤—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–û—Ä–µ—Ö–æ–≤–æ-–ó—É–µ–≤–æ": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–û—Ä–µ—Ö–æ–≤–æ", "–ó—É–µ–≤–æ"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–û—Ä–µ—Ö–æ–≤–æ": "active", "–ó—É–µ–≤–æ": "active"}
    },
    "–°–µ—Ä–ø—É—Ö–æ–≤": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–®–∞—Ö—Ç—ã": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ê—Ä—Ç—ë–º–æ–≤—Å–∫–∏–π", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ê—Ä—Ç—ë–º–æ–≤—Å–∫–∏–π": "active", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π": "active"}
    },
    "–ù–æ–≥–∏–Ω—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°—Ç–∞—Ä–∞—è –ö—É–ø–∞–≤–Ω–∞", "–≠–ª–µ–∫—Ç—Ä–æ—É–≥–ª–∏"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°—Ç–∞—Ä–∞—è –ö—É–ø–∞–≤–Ω–∞": "active", "–≠–ª–µ–∫—Ç—Ä–æ—É–≥–ª–∏": "active"}
    },
    "–î–µ—Ä–±–µ–Ω—Ç": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ö–∞—Å–ø–∏–π—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ù–µ—Ñ—Ç–µ—é–≥–∞–Ω—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ù–æ–≤–æ—É—Ä–∞–ª—å—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ü—è—Ç–∏–≥–æ—Ä—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ö–∏—Å–ª–æ–≤–æ–¥—Å–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ï—Å—Å–µ–Ω—Ç—É–∫–∏": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–°–µ–≤–µ—Ä–Ω—ã–π": "active", "–Æ–∂–Ω—ã–π": "active"}
    },
    "–ù–∞–ª—å—á–∏–∫": {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ò—Å–ø—Ä–∞–≤–Ω—ã–π", "–°—Ç—Ä–µ–ª–∫–∞"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active", "–ò—Å–ø—Ä–∞–≤–Ω—ã–π": "active", "–°—Ç—Ä–µ–ª–∫–∞": "active"}
    }
}

CATEGORIES = {
    "sedatives": "üí§ –£—Å–ø–æ–∫–æ–∏—Ç–µ–ª—å–Ω—ã–µ",
    "stimulants": "üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã",
    "hallucinogens": "üçÑ –ì—Ä–∏–±—ã / LSD"
}

PRODUCTS = {
    "sedatives": [
        {
            "name": "üíä –ú–µ—Ç–∞–¥–æ–Ω VHQ", "price": 6500, "weight": "2g", "type": "–ú–∞–≥–Ω–∏—Ç",
            "desc": "üíé <b>–ú–µ—Ç–∞–¥–æ–Ω –≤—ã—Å–æ—á–∞–π—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ VHQ</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ö—Ä–∏—Å—Ç–∞–ª—å–Ω–æ –±–µ–ª—ã–π —Ü–≤–µ—Ç, –±–µ–∑ –ø—Ä–∏–º–µ—Å–µ–π\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 98%+\n‚Ä¢ –ú–æ—â–Ω—ã–π –∏ –¥–æ–ª–≥–∏–π —ç—Ñ—Ñ–µ–∫—Ç (8-12 —á–∞—Å–æ–≤)\n‚Ä¢ –ú—è–≥–∫–∏–π –≤—Ö–æ–¥, –ø–ª–∞–≤–Ω–æ–µ –ø–ª–∞—Ç–æ\n‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ì–ª—É–±–æ–∫–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ, —ç–π—Ñ–æ—Ä–∏—è, —á—É–≤—Å—Ç–≤–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏—è. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏ —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞, –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–ª–∞–≥–∏\n‚úÖ <b>–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞:</b> –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ"
        },
        {
            "name": "üíä –ú–µ—Ç–∞–¥–æ–Ω VHQ", "price": 12000, "weight": "5g", "type": "–ú–∞–≥–Ω–∏—Ç",
            "desc": "üíé <b>–ú–µ—Ç–∞–¥–æ–Ω –≤—ã—Å–æ—á–∞–π—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ VHQ</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ö—Ä–∏—Å—Ç–∞–ª—å–Ω–æ –±–µ–ª—ã–π —Ü–≤–µ—Ç, –±–µ–∑ –ø—Ä–∏–º–µ—Å–µ–π\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 98%+\n‚Ä¢ –ú–æ—â–Ω—ã–π –∏ –¥–æ–ª–≥–∏–π —ç—Ñ—Ñ–µ–∫—Ç (8-12 —á–∞—Å–æ–≤)\n‚Ä¢ –ú—è–≥–∫–∏–π –≤—Ö–æ–¥, –ø–ª–∞–≤–Ω–æ–µ –ø–ª–∞—Ç–æ\n‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ì–ª—É–±–æ–∫–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ, —ç–π—Ñ–æ—Ä–∏—è, —á—É–≤—Å—Ç–≤–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏—è. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏ —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞, –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–ª–∞–≥–∏\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 2500‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5–≥\n‚úÖ <b>–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞:</b> –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ"
        },
        {
            "name": "üç´ –ì–∞—à–∏—à Ice O Lator", "price": 4000, "weight": "2g", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üî• <b>–ì–∞—à–∏—à Ice O Lator - –ø—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –≥–∞—à–∏—à –∏–∑ –ª—É—á—à–∏—Ö —Å–æ—Ä—Ç–æ–≤ —à–∏—à–µ–∫\n‚Ä¢ –ú–µ—Ç–æ–¥ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: Ice Water Hash\n‚Ä¢ –ú—è–≥–∫–∏–π, –ª–∏–ø–∫–∏–π, –Ω–µ –∫—Ä–æ—à–∏—Ç—Å—è\n‚Ä¢ –ü–æ—Ç—Ä—è—Å–∞—é—â–∏–π —Ä–∞–¥—É–∂–Ω—ã–π –∞—Ä–æ–º–∞—Ç\n‚Ä¢ –ë–µ–∑ —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö –¥–æ–±–∞–≤–æ–∫\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–æ—â–Ω–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ, –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è. –ò–¥–µ–∞–ª–µ–Ω –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –ª—é–¥–µ–π –∏ –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç–¥—ã—Ö–∞.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –ü–µ—Ä–≥–∞–º–µ–Ω—Ç–Ω–∞—è –±—É–º–∞–≥–∞ + –≤–∞–∫—É—É–º\n‚úÖ <b>–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:</b> –í—ã—Ä–∞—â–µ–Ω–æ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –≥—Ä—É–Ω—Ç–µ"
        },
        {
            "name": "üç´ –ì–∞—à–∏—à Ice O Lator", "price": 9000, "weight": "5g", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üî• <b>–ì–∞—à–∏—à Ice O Lator - –ø—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –≥–∞—à–∏—à –∏–∑ –ª—É—á—à–∏—Ö —Å–æ—Ä—Ç–æ–≤ —à–∏—à–µ–∫\n‚Ä¢ –ú–µ—Ç–æ–¥ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: Ice Water Hash\n‚Ä¢ –ú—è–≥–∫–∏–π, –ª–∏–ø–∫–∏–π, –Ω–µ –∫—Ä–æ—à–∏—Ç—Å—è\n‚Ä¢ –ü–æ—Ç—Ä—è—Å–∞—é—â–∏–π —Ä–∞–¥—É–∂–Ω—ã–π –∞—Ä–æ–º–∞—Ç\n‚Ä¢ –ë–µ–∑ —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö –¥–æ–±–∞–≤–æ–∫\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–æ—â–Ω–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ, –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è. –ò–¥–µ–∞–ª–µ–Ω –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –ª—é–¥–µ–π –∏ –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç–¥—ã—Ö–∞.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –ü–µ—Ä–≥–∞–º–µ–Ω—Ç–Ω–∞—è –±—É–º–∞–≥–∞ + –≤–∞–∫—É—É–º\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 1000‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5–≥\n‚úÖ <b>–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:</b> –í—ã—Ä–∞—â–µ–Ω–æ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –≥—Ä—É–Ω—Ç–µ"
        },
        {
            "name": "ü•¶ –®–∏—à–∫–∏ Runtz B52", "price": 4500, "weight": "2g", "type": "–ú–∞–≥–Ω–∏—Ç",
            "desc": "üåø <b>–®–∏—à–∫–∏ Runtz B52 - –ø—Ä–µ–º–∏—É–º —Å–æ—Ä—Ç</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ì–∏–±—Ä–∏–¥ —Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–Ω–∏–µ–º –∏–Ω–¥–∏–∫–∏ (70/30)\n‚Ä¢ –ê—Ä–æ–º–∞—Ç: —Å–ª–∞–¥–∫–∏–π, —Ñ—Ä—É–∫—Ç–æ–≤—ã–π, —Å –Ω–æ—Ç–∫–∞–º–∏ –∫–æ–Ω—Ñ–µ—Ç\n‚Ä¢ –ü–ª–æ—Ç–Ω—ã–µ, —Å–º–æ–ª–∏—Å—Ç—ã–µ —à–∏—à–∫–∏\n‚Ä¢ –í—ã—Ä–∞—â–µ–Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º–∏ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –≥—Ä—É–Ω—Ç–µ\n‚Ä¢ –û–±—Ä–µ–∑–∫–∞: —Ä—É—á–Ω–∞—è, –ø—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ì–ª—É–±–æ–∫–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ç–µ–ª–∞, —ç–π—Ñ–æ—Ä–∏—è, —É–ª—É—á—à–µ–Ω–∏–µ –∞–ø–ø–µ—Ç–∏—Ç–∞. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏ —Å–Ω—è—Ç–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –≤–ª–∞–∂–Ω–æ—Å—Ç–∏\n‚úÖ <b>–¢–ì–ö:</b> 22-25%"
        },
        {
            "name": "ü•¶ –®–∏—à–∫–∏ Runtz B52", "price": 10000, "weight": "5g", "type": "–ú–∞–≥–Ω–∏—Ç",
            "desc": "üåø <b>–®–∏—à–∫–∏ Runtz B52 - –ø—Ä–µ–º–∏—É–º —Å–æ—Ä—Ç</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ì–∏–±—Ä–∏–¥ —Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–Ω–∏–µ–º –∏–Ω–¥–∏–∫–∏ (70/30)\n‚Ä¢ –ê—Ä–æ–º–∞—Ç: —Å–ª–∞–¥–∫–∏–π, —Ñ—Ä—É–∫—Ç–æ–≤—ã–π, —Å –Ω–æ—Ç–∫–∞–º–∏ –∫–æ–Ω—Ñ–µ—Ç\n‚Ä¢ –ü–ª–æ—Ç–Ω—ã–µ, —Å–º–æ–ª–∏—Å—Ç—ã–µ —à–∏—à–∫–∏\n‚Ä¢ –í—ã—Ä–∞—â–µ–Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º–∏ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –≥—Ä—É–Ω—Ç–µ\n‚Ä¢ –û–±—Ä–µ–∑–∫–∞: —Ä—É—á–Ω–∞—è, –ø—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ì–ª—É–±–æ–∫–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ç–µ–ª–∞, —ç–π—Ñ–æ—Ä–∏—è, —É–ª—É—á—à–µ–Ω–∏–µ –∞–ø–ø–µ—Ç–∏—Ç–∞. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏ —Å–Ω—è—Ç–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –≤–ª–∞–∂–Ω–æ—Å—Ç–∏\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 1250‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5–≥\n‚úÖ <b>–¢–ì–ö:</b> 22-25%"
        },
        {
            "name": "ü•§ –°–∏—Ä–æ–ø Wockhardt", "price": 15000, "weight": "1 fl oz", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>–°–∏—Ä–æ–ø Wockhardt - –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –æ—Ä–∏–≥–∏–Ω–∞–ª</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è\n‚Ä¢ –í–∫—É—Å: –≤–∏–Ω–æ–≥—Ä–∞–¥–Ω—ã–π, –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π\n‚Ä¢ –û–±—ä–µ–º: 30ml (1 fl oz)\n‚Ä¢ –†–µ–¥–∫–æ—Å—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ\n‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤ –¥–ª—è –∏—Å—Ç–∏–Ω–Ω—ã—Ö —Ü–µ–Ω–∏—Ç–µ–ª–µ–π\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–æ—â–Ω–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ, —ç–π—Ñ–æ—Ä–∏—è, —Å–Ω—è—Ç–∏–µ –±–æ–ª–∏. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç–¥—ã—Ö–∞ –∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–ª–∞–∫–æ–Ω —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –≤—Å–∫—Ä—ã—Ç–∏—è\n‚úÖ <b>–ì–∞—Ä–∞–Ω—Ç–∏—è:</b> 100% –æ—Ä–∏–≥–∏–Ω–∞–ª, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ"
        }
    ],
    "stimulants": [
        {
            "name": "‚ùÑÔ∏è –ö–æ–∫–∞–∏–Ω VHQ (Fish Scale)", "price": 10000, "weight": "1g", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>–ö–æ–∫–∞–∏–Ω Fish Scale - –ø—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 92%+\n‚Ä¢ –í–Ω–µ—à–Ω–∏–π –≤–∏–¥: —á–µ—à—É–π–∫–∏ —Å –ø–µ—Ä–ª–∞–º—É—Ç—Ä–æ–≤—ã–º –±–ª–µ—Å–∫–æ–º\n‚Ä¢ –¢–µ–∫—Å—Ç—É—Ä–∞: –ø–ª–æ—Ç–Ω–∞—è, –º–∞—Å–ª—è–Ω–∏—Å—Ç–∞—è\n‚Ä¢ –ó–∞–ø–∞—Ö: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–π, —á–∏—Å—Ç—ã–π\n‚Ä¢ –ë–µ–∑ —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏—è\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–∏–ª–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏, —ç–π—Ñ–æ—Ä–∏—è, –ø–æ–≤—ã—à–µ–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —É–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏. –≠—Ñ—Ñ–µ–∫—Ç –¥–ª–∏—Ç—Å—è 30-60 –º–∏–Ω—É—Ç.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:</b> –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫\n‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b> –°–æ–±–ª—é–¥–∞–π—Ç–µ –¥–æ–∑–∏—Ä–æ–≤–∫—É"
        },
        {
            "name": "‚ùÑÔ∏è –ö–æ–∫–∞–∏–Ω VHQ (Fish Scale)", "price": 19000, "weight": "2g", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>–ö–æ–∫–∞–∏–Ω Fish Scale - –ø—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 92%+\n‚Ä¢ –í–Ω–µ—à–Ω–∏–π –≤–∏–¥: —á–µ—à—É–π–∫–∏ —Å –ø–µ—Ä–ª–∞–º—É—Ç—Ä–æ–≤—ã–º –±–ª–µ—Å–∫–æ–º\n‚Ä¢ –¢–µ–∫—Å—Ç—É—Ä–∞: –ø–ª–æ—Ç–Ω–∞—è, –º–∞—Å–ª—è–Ω–∏—Å—Ç–∞—è\n‚Ä¢ –ó–∞–ø–∞—Ö: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–π, —á–∏—Å—Ç—ã–π\n‚Ä¢ –ë–µ–∑ —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏—è\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–∏–ª–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏, —ç–π—Ñ–æ—Ä–∏—è, –ø–æ–≤—ã—à–µ–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —É–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏. –≠—Ñ—Ñ–µ–∫—Ç –¥–ª–∏—Ç—Å—è 30-60 –º–∏–Ω—É—Ç.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 1000‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 2–≥\n‚úÖ <b>–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:</b> –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫\n‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b> –°–æ–±–ª—é–¥–∞–π—Ç–µ –¥–æ–∑–∏—Ä–æ–≤–∫—É"
        },
        {
            "name": "‚ö™Ô∏è Alpha PVP –ñ–µ–º—á—É–∂–Ω–∞—è", "price": 5000, "weight": "2g", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üíé <b>Alpha PVP –ñ–µ–º—á—É–∂–Ω–∞—è - –ø—Ä–µ–º–∏—É–º –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ö—Ä–∏—Å—Ç–∞–ª–ª—ã –∂–µ–º—á—É–∂–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞\n‚Ä¢ –†–∞–∑–º–µ—Ä: –∫—Ä—É–ø–Ω—ã–µ, –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–µ\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 95%+\n‚Ä¢ –í—ã—Å–æ–∫–∞—è —Å—Ç–µ–ø–µ–Ω—å –æ—á–∏—Å—Ç–∫–∏\n‚Ä¢ –ë–µ–∑ –ø—Ä–∏–º–µ—Å–µ–π\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–æ—â–Ω—ã–π —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–∏–ª–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏, —ç–π—Ñ–æ—Ä–∏—è, –ø–æ–≤—ã—à–µ–Ω–∏–µ –ª–∏–±–∏–¥–æ. –≠—Ñ—Ñ–µ–∫—Ç –¥–ª–∏—Ç—Å—è 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è:</b> –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —á–∏—Å—Ç–æ—Ç—É\n‚ö†Ô∏è <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        },
        {
            "name": "‚ö™Ô∏è Alpha PVP –ñ–µ–º—á—É–∂–Ω–∞—è", "price": 11000, "weight": "5g", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üíé <b>Alpha PVP –ñ–µ–º—á—É–∂–Ω–∞—è - –ø—Ä–µ–º–∏—É–º –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ö—Ä–∏—Å—Ç–∞–ª–ª—ã –∂–µ–º—á—É–∂–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞\n‚Ä¢ –†–∞–∑–º–µ—Ä: –∫—Ä—É–ø–Ω—ã–µ, –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–µ\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 95%+\n‚Ä¢ –í—ã—Å–æ–∫–∞—è —Å—Ç–µ–ø–µ–Ω—å –æ—á–∏—Å—Ç–∫–∏\n‚Ä¢ –ë–µ–∑ –ø—Ä–∏–º–µ—Å–µ–π\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–æ—â–Ω—ã–π —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–∏–ª–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏, —ç–π—Ñ–æ—Ä–∏—è, –ø–æ–≤—ã—à–µ–Ω–∏–µ –ª–∏–±–∏–¥–æ. –≠—Ñ—Ñ–µ–∫—Ç –¥–ª–∏—Ç—Å—è 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 1400‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5–≥\n‚úÖ <b>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è:</b> –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —á–∏—Å—Ç–æ—Ç—É\n‚ö†Ô∏è <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        },
        {
            "name": "üßä Alpha PVP –°–∏–Ω–∏–π –ª—ë–¥", "price": 5000, "weight": "2g", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>Alpha PVP –°–∏–Ω–∏–π –ª—ë–¥ - —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ö—Ä—É–ø–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã —Ü–≤–µ—Ç–∞ —Å–∏–Ω–µ–≥–æ –ª—å–¥–∞\n‚Ä¢ –†–∞–∑–º–µ—Ä: –æ—Ç 0.5 –¥–æ 2—Å–º\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 94%+\n‚Ä¢ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ\n‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ö–ª–∞—Å—Å–∏–∫–∞ –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π —Å–∫–æ—Ä–æ—Å—Ç–∏. –ú–æ—â–Ω—ã–π –ø—Ä–∏—Ö–æ–¥, –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –ø–ª–∞—Ç–æ, —ç–π—Ñ–æ—Ä–∏—è. –≠—Ñ—Ñ–µ–∫—Ç 5-7 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</b> –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–µ"
        },
        {
            "name": "üî¥ Alpha PVP –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª", "price": 5500, "weight": "2g", "type": "–ú–∞–≥–Ω–∏—Ç",
            "desc": "üíé <b>Alpha PVP –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª - —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã\n‚Ä¢ –û—Å–æ–±–∞—è —Ñ–æ—Ä–º—É–ª–∞ –æ—á–∏—Å—Ç–∫–∏\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 96%+\n‚Ä¢ –ú—è–≥–∫–∏–π –≤—Ö–æ–¥\n‚Ä¢ –î–æ–ª–≥–æ–µ –ø–ª–∞—Ç–æ\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ë–æ–ª–µ–µ –º—è–≥–∫–∏–π –≤—Ö–æ–¥ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω–æ–π –∞–ª—å—Ñ–æ–π, –¥–æ–ª–≥–æ–µ –ø–ª–∞—Ç–æ –±–µ–∑ —Ä–µ–∑–∫–∏—Ö —Å–ø–∞–¥–æ–≤. –Ø—Ä–∫–∏–µ –æ—â—É—â–µ–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã. –≠—Ñ—Ñ–µ–∫—Ç 6-8 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–≠–∫—Å–∫–ª—é–∑–∏–≤:</b> –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–∞—Ä—Ç–∏—è\n‚≠ê <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ü–µ–Ω–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ"
        },
        {
            "name": "‚ùÑÔ∏è –ú–µ—Ñ–µ–¥—Ä–æ–Ω VHQ (–∫—Ä–∏—Å—Ç–∞–ª–ª—ã)", "price": 4500, "weight": "2g", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üíé <b>–ú–µ—Ñ–µ–¥—Ä–æ–Ω VHQ - –∏–≥–æ–ª—å—á–∞—Ç—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ò–≥–æ–ª—å—á–∞—Ç—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –±–µ–ª–æ–≥–æ —Ü–≤–µ—Ç–∞\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 97%+\n‚Ä¢ –¢–µ–∫—Å—Ç—É—Ä–∞: —Ä–∞—Å—Å—ã–ø—á–∞—Ç–∞—è, –ª–µ–≥–∫–æ –∏–∑–º–µ–ª—å—á–∞–µ—Ç—Å—è\n‚Ä¢ –ë–µ–∑ –∑–∞–ø–∞—Ö–∞\n‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–≠–π—Ñ–æ—Ä–∏—è, —ç–º–ø–∞—Ç–∏—è, –ª–µ–≥–∫–æ—Å—Ç—å, –∂–µ–ª–∞–Ω–∏–µ –æ–±—â–∞—Ç—å—Å—è. –ò–¥–µ–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –æ—Ç–¥—ã—Ö–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ —Å–æ–ª–æ. –≠—Ñ—Ñ–µ–∫—Ç 3-5 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å:</b> –û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\nüí° <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</b> –ú—è–≥–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç, –º–∏–Ω–∏–º—É–º –ø–æ–±–æ—á–µ–∫"
        },
        {
            "name": "‚ùÑÔ∏è –ú–µ—Ñ–µ–¥—Ä–æ–Ω VHQ (–∫—Ä–∏—Å—Ç–∞–ª–ª—ã)", "price": 10000, "weight": "5g", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üíé <b>–ú–µ—Ñ–µ–¥—Ä–æ–Ω VHQ - –∏–≥–æ–ª—å—á–∞—Ç—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ò–≥–æ–ª—å—á–∞—Ç—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –±–µ–ª–æ–≥–æ —Ü–≤–µ—Ç–∞\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 97%+\n‚Ä¢ –¢–µ–∫—Å—Ç—É—Ä–∞: —Ä–∞—Å—Å—ã–ø—á–∞—Ç–∞—è, –ª–µ–≥–∫–æ –∏–∑–º–µ–ª—å—á–∞–µ—Ç—Å—è\n‚Ä¢ –ë–µ–∑ –∑–∞–ø–∞—Ö–∞\n‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–≠–π—Ñ–æ—Ä–∏—è, —ç–º–ø–∞—Ç–∏—è, –ª–µ–≥–∫–æ—Å—Ç—å, –∂–µ–ª–∞–Ω–∏–µ –æ–±—â–∞—Ç—å—Å—è. –ò–¥–µ–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –æ—Ç–¥—ã—Ö–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ —Å–æ–ª–æ. –≠—Ñ—Ñ–µ–∫—Ç 3-5 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 1250‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5–≥\n‚úÖ <b>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å:</b> –û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\nüí° <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</b> –ú—è–≥–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç, –º–∏–Ω–∏–º—É–º –ø–æ–±–æ—á–µ–∫"
        },
        {
            "name": "‚ö°Ô∏è –ê–º—Ñ–µ—Ç–∞–º–∏–Ω —Å—É–ª—å—Ñ–∞—Ç", "price": 3500, "weight": "2g", "type": "–ú–∞–≥–Ω–∏—Ç",
            "desc": "üíé <b>–ê–º—Ñ–µ—Ç–∞–º–∏–Ω —Å—É–ª—å—Ñ–∞—Ç - –∫–ª–∞—Å—Å–∏–∫–∞</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—É–ª—å—Ñ–∞—Ç –∞–º—Ñ–µ—Ç–∞–º–∏–Ω–∞\n‚Ä¢ –¶–≤–µ—Ç: –±–µ–ª—ã–π/—Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π –ø–æ—Ä–æ—à–æ–∫\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 85%+\n‚Ä¢ –†–æ–≤–Ω—ã–π —Å—Ç–∏–º\n‚Ä¢ –ë–µ–∑ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –≤–Ω–∏–º–∞–Ω–∏—è, –±–æ–¥—Ä–æ—Å—Ç—å, –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã, —É—á–µ–±—ã –∏–ª–∏ –≤–µ—á–µ—Ä–∏–Ω–∫–∏. –≠—Ñ—Ñ–µ–∫—Ç 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:</b> –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞\nüí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –æ–ø—ã—Ç–Ω—ã—Ö"
        },
        {
            "name": "‚ö°Ô∏è –ê–º—Ñ–µ—Ç–∞–º–∏–Ω —Å—É–ª—å—Ñ–∞—Ç", "price": 8000, "weight": "5g", "type": "–ú–∞–≥–Ω–∏—Ç",
            "desc": "üíé <b>–ê–º—Ñ–µ—Ç–∞–º–∏–Ω —Å—É–ª—å—Ñ–∞—Ç - –∫–ª–∞—Å—Å–∏–∫–∞</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—É–ª—å—Ñ–∞—Ç –∞–º—Ñ–µ—Ç–∞–º–∏–Ω–∞\n‚Ä¢ –¶–≤–µ—Ç: –±–µ–ª—ã–π/—Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π –ø–æ—Ä–æ—à–æ–∫\n‚Ä¢ –ß–∏—Å—Ç–æ—Ç–∞: 85%+\n‚Ä¢ –†–æ–≤–Ω—ã–π —Å—Ç–∏–º\n‚Ä¢ –ë–µ–∑ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –≤–Ω–∏–º–∞–Ω–∏—è, –±–æ–¥—Ä–æ—Å—Ç—å, –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã, —É—á–µ–±—ã –∏–ª–∏ –≤–µ—á–µ—Ä–∏–Ω–∫–∏. –≠—Ñ—Ñ–µ–∫—Ç 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 750‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5–≥\n‚úÖ <b>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:</b> –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞\nüí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –æ–ø—ã—Ç–Ω—ã—Ö"
        },
        {
            "name": "üíÄ –≠–∫—Å—Ç–∞–∑–∏ —á–µ—Ä–µ–ø–∞", "price": 2500, "weight": "2 —à—Ç", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>–≠–∫—Å—Ç–∞–∑–∏ —á–µ—Ä–µ–ø–∞ - –ø—Ä–µ–º–∏—É–º —Ç–∞–±–ª—ã</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –¢–∞–±–ª—ã –≤ —Ñ–æ—Ä–º–µ —á–µ—Ä–µ–ø–æ–≤\n‚Ä¢ –í—ã—Å–æ–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ú–î–ú–ê: 180-220–º–≥\n‚Ä¢ –¶–≤–µ—Ç: —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–π (–∫—Ä–∞—Å–Ω—ã–π, —Å–∏–Ω–∏–π, –∑–µ–ª–µ–Ω—ã–π)\n‚Ä¢ –î–∏–∑–∞–π–Ω: –æ–±—ä–µ–º–Ω—ã–π —á–µ—Ä–µ–ø\n‚Ä¢ –ß–∏—Å—Ç—ã–π –ú–î–ú–ê –±–µ–∑ –ø—Ä–∏–º–µ—Å–µ–π\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ß–∏—Å—Ç–∞—è —ç–π—Ñ–æ—Ä–∏—è, –º–∞–∑–∞–Ω–∏–Ω–∞, –ª—é–±–æ–≤—å –∫–æ –≤—Å–µ–º—É –º–∏—Ä—É, —ç–º–ø–∞—Ç–∏—è. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–æ–∫ –∏ —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ–π. –≠—Ñ—Ñ–µ–∫—Ç 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:</b> –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —á–∏—Å—Ç–æ—Ç—É\nüí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        },
        {
            "name": "üíÄ –≠–∫—Å—Ç–∞–∑–∏ —á–µ—Ä–µ–ø–∞", "price": 5500, "weight": "5 —à—Ç", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>–≠–∫—Å—Ç–∞–∑–∏ —á–µ—Ä–µ–ø–∞ - –ø—Ä–µ–º–∏—É–º —Ç–∞–±–ª—ã</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –¢–∞–±–ª—ã –≤ —Ñ–æ—Ä–º–µ —á–µ—Ä–µ–ø–æ–≤\n‚Ä¢ –í—ã—Å–æ–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ú–î–ú–ê: 180-220–º–≥\n‚Ä¢ –¶–≤–µ—Ç: —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–π (–∫—Ä–∞—Å–Ω—ã–π, —Å–∏–Ω–∏–π, –∑–µ–ª–µ–Ω—ã–π)\n‚Ä¢ –î–∏–∑–∞–π–Ω: –æ–±—ä–µ–º–Ω—ã–π —á–µ—Ä–µ–ø\n‚Ä¢ –ß–∏—Å—Ç—ã–π –ú–î–ú–ê –±–µ–∑ –ø—Ä–∏–º–µ—Å–µ–π\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ß–∏—Å—Ç–∞—è —ç–π—Ñ–æ—Ä–∏—è, –º–∞–∑–∞–Ω–∏–Ω–∞, –ª—é–±–æ–≤—å –∫–æ –≤—Å–µ–º—É –º–∏—Ä—É, —ç–º–ø–∞—Ç–∏—è. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–æ–∫ –∏ —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ–π. –≠—Ñ—Ñ–µ–∫—Ç 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 700‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5—à—Ç\n‚úÖ <b>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:</b> –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —á–∏—Å—Ç–æ—Ç—É\nüí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        },
        {
            "name": "‚¨õÔ∏è –≠–∫—Å—Ç–∞–∑–∏ Black Cube", "price": 2500, "weight": "2 —à—Ç", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üíé <b>–≠–∫—Å—Ç–∞–∑–∏ Black Cube - –º–æ—â–Ω–µ–π—à–∏–µ —Ç–∞–±–ª—ã</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ß–µ—Ä–Ω—ã–µ –∫—É–±—ã —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º\n‚Ä¢ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ú–î–ú–ê: 200-250–º–≥\n‚Ä¢ –§–æ—Ä–º–∞: –∏–¥–µ–∞–ª—å–Ω—ã–π –∫—É–±\n‚Ä¢ –¶–≤–µ—Ç: –≥–ª—è–Ω—Ü–µ–≤—ã–π —á–µ—Ä–Ω—ã–π\n‚Ä¢ –ú–æ—â–Ω–µ–π—à–∏–π –ø—Ä–∏—Ö–æ–¥\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–æ—â–Ω–µ–π—à–∏–π –ø—Ä–∏—Ö–æ–¥, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–ª–µ—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤. –¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö —é–∑–µ—Ä–æ–≤. –≠–π—Ñ–æ—Ä–∏—è, —ç–º–ø–∞—Ç–∏—è, –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã. –≠—Ñ—Ñ–µ–∫—Ç 5-7 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</b> –û–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö —Å–∏–ª—å–Ω—ã—Ö —Ç–∞–±–ª–æ–≤ –Ω–∞ —Ä—ã–Ω–∫–µ\n‚ö†Ô∏è <b>–í–Ω–∏–º–∞–Ω–∏–µ:</b> –¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö!"
        },
        {
            "name": "‚¨õÔ∏è –≠–∫—Å—Ç–∞–∑–∏ Black Cube", "price": 5500, "weight": "5 —à—Ç", "type": "–ü—Ä–∏–∫–æ–ø",
            "desc": "üíé <b>–≠–∫—Å—Ç–∞–∑–∏ Black Cube - –º–æ—â–Ω–µ–π—à–∏–µ —Ç–∞–±–ª—ã</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –ß–µ—Ä–Ω—ã–µ –∫—É–±—ã —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º\n‚Ä¢ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ú–î–ú–ê: 200-250–º–≥\n‚Ä¢ –§–æ—Ä–º–∞: –∏–¥–µ–∞–ª—å–Ω—ã–π –∫—É–±\n‚Ä¢ –¶–≤–µ—Ç: –≥–ª—è–Ω—Ü–µ–≤—ã–π —á–µ—Ä–Ω—ã–π\n‚Ä¢ –ú–æ—â–Ω–µ–π—à–∏–π –ø—Ä–∏—Ö–æ–¥\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–ú–æ—â–Ω–µ–π—à–∏–π –ø—Ä–∏—Ö–æ–¥, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–ª–µ—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤. –¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö —é–∑–µ—Ä–æ–≤. –≠–π—Ñ–æ—Ä–∏—è, —ç–º–ø–∞—Ç–∏—è, –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã. –≠—Ñ—Ñ–µ–∫—Ç 5-7 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 700‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5—à—Ç\n‚úÖ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</b> –û–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö —Å–∏–ª—å–Ω—ã—Ö —Ç–∞–±–ª–æ–≤ –Ω–∞ —Ä—ã–Ω–∫–µ\n‚ö†Ô∏è <b>–í–Ω–∏–º–∞–Ω–∏–µ:</b> –¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö!"
        }
    ],
    "hallucinogens": [
        {
            "name": "üé´ –ú–∞—Ä–∫–∏ NBOMe", "price": 2000, "weight": "2 —à—Ç", "type": "–ö–æ–Ω–≤–µ—Ä—Ç",
            "desc": "üíé <b>–ú–∞—Ä–∫–∏ NBOMe - –ø—Å–∏—Ö–æ–¥–µ–ª–∏—á–µ—Å–∫–∏–µ –º–∞—Ä–∫–∏</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –î–æ–∑–∏—Ä–æ–≤–∫–∞: 1200–º–∫–≥ –Ω–∞ –º–∞—Ä–∫—É\n‚Ä¢ –î–∏–∑–∞–π–Ω: —è—Ä–∫–∏–µ, –∫—Ä–∞—Å–æ—á–Ω—ã–µ —Ä–∏—Å—É–Ω–∫–∏\n‚Ä¢ –†–∞–∑–º–µ—Ä: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (5x5–º–º)\n‚Ä¢ –î–µ–π—Å—Ç–≤—É—é—â–µ–µ –≤–µ—â–µ—Å—Ç–≤–æ: 25I-NBOMe\n‚Ä¢ –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–Ø—Ä–∫–∏–µ –≤–∏–∑—É–∞–ª—ã, –≥–ª—É–±–æ–∫–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ. –°–∏–ª—å–Ω—ã–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞. –≠—Ñ—Ñ–µ–∫—Ç 8-12 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –ö–æ–Ω–≤–µ—Ä—Ç —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —Å–≤–µ—Ç–∞\n‚úÖ <b>–í–∞–∂–Ω–æ:</b> –°–æ–±–ª—é–¥–∞–π—Ç–µ –¥–æ–∑–∏—Ä–æ–≤–∫—É!\n‚ö†Ô∏è <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        },
        {
            "name": "üé´ –ú–∞—Ä–∫–∏ NBOMe", "price": 4500, "weight": "5 —à—Ç", "type": "–ö–æ–Ω–≤–µ—Ä—Ç",
            "desc": "üíé <b>–ú–∞—Ä–∫–∏ NBOMe - –ø—Å–∏—Ö–æ–¥–µ–ª–∏—á–µ—Å–∫–∏–µ –º–∞—Ä–∫–∏</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –î–æ–∑–∏—Ä–æ–≤–∫–∞: 1200–º–∫–≥ –Ω–∞ –º–∞—Ä–∫—É\n‚Ä¢ –î–∏–∑–∞–π–Ω: —è—Ä–∫–∏–µ, –∫—Ä–∞—Å–æ—á–Ω—ã–µ —Ä–∏—Å—É–Ω–∫–∏\n‚Ä¢ –†–∞–∑–º–µ—Ä: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (5x5–º–º)\n‚Ä¢ –î–µ–π—Å—Ç–≤—É—é—â–µ–µ –≤–µ—â–µ—Å—Ç–≤–æ: 25I-NBOMe\n‚Ä¢ –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–Ø—Ä–∫–∏–µ –≤–∏–∑—É–∞–ª—ã, –≥–ª—É–±–æ–∫–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ. –°–∏–ª—å–Ω—ã–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞. –≠—Ñ—Ñ–µ–∫—Ç 8-12 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –ö–æ–Ω–≤–µ—Ä—Ç —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —Å–≤–µ—Ç–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 500‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5—à—Ç\n‚úÖ <b>–í–∞–∂–Ω–æ:</b> –°–æ–±–ª—é–¥–∞–π—Ç–µ –¥–æ–∑–∏—Ä–æ–≤–∫—É!\n‚ö†Ô∏è <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –¢–æ–ª—å–∫–æ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
        },
        {
            "name": "üê∏ 2CB Toad", "price": 3000, "weight": "2 —à—Ç", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>2CB Toad - –ø—Å–∏—Ö–æ–¥–µ–ª–∏–∫ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</b>\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –î–æ–∑–∏—Ä–æ–≤–∫–∞: 20–º–≥ –Ω–∞ —Ç–∞–±–ª—É\n‚Ä¢ –§–æ—Ä–º–∞: —Ç–∞–±–ª–µ—Ç–∫–∞ —Å –ª—è–≥—É—à–∫–æ–π\n‚Ä¢ –¶–≤–µ—Ç: —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–π\n‚Ä¢ –°–æ—á–µ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã –õ–°–î –∏ –ú–î–ú–ê\n‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–í–∏–∑—É–∞–ª—ã —Å—Ä–µ–¥–Ω–µ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏, —ç–º–ø–∞—Ç–∏—è, —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è. –ú—è–≥—á–µ —á–µ–º –õ–°–î, –Ω–æ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–æ–∫ –∏ —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ–π. –≠—Ñ—Ñ–µ–∫—Ç 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</b> –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\nüí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –æ–ø—ã—Ç–Ω—ã—Ö"
        },
        {
            "name": "üê∏ 2CB Toad", "price": 7000, "weight": "5 —à—Ç", "type": "–¢–∞–π–Ω–∏–∫",
            "desc": "üíé <b>2CB Toad - –ø—Å–∏—Ö–æ–¥–µ–ª–∏–∫ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</b> (–≤—ã–≥–æ–¥–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞)\n\n‚ú® <b>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</b>\n‚Ä¢ –î–æ–∑–∏—Ä–æ–≤–∫–∞: 20–º–≥ –Ω–∞ —Ç–∞–±–ª—É\n‚Ä¢ –§–æ—Ä–º–∞: —Ç–∞–±–ª–µ—Ç–∫–∞ —Å –ª—è–≥—É—à–∫–æ–π\n‚Ä¢ –¶–≤–µ—Ç: —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–π\n‚Ä¢ –°–æ—á–µ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã –õ–°–î –∏ –ú–î–ú–ê\n‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ\n\nüéØ <b>–≠—Ñ—Ñ–µ–∫—Ç:</b>\n–í–∏–∑—É–∞–ª—ã —Å—Ä–µ–¥–Ω–µ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏, —ç–º–ø–∞—Ç–∏—è, —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è. –ú—è–≥—á–µ —á–µ–º –õ–°–î, –Ω–æ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á–µ—Ä–∏–Ω–æ–∫ –∏ —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ–π. –≠—Ñ—Ñ–µ–∫—Ç 4-6 —á–∞—Å–æ–≤.\n\nüì¶ <b>–£–ø–∞–∫–æ–≤–∫–∞:</b> –í–∞–∫—É—É–º–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\nüí∞ <b>–í—ã–≥–æ–¥–Ω–æ:</b> –≠–∫–æ–Ω–æ–º–∏—è 500‚ÇΩ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ 5—à—Ç\n‚úÖ <b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</b> –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\nüí° <b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</b> –î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –æ–ø—ã—Ç–Ω—ã—Ö"
        }
    ]
}

PAYMENT_METHODS = {
    "BTC": "bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh",
    "LTC": "ltc1q5wmr9a37458739938475893475893475",
    "Card": "4400 0000 0000 0000"
}

# --- STATES ---
class PaymentState(StatesGroup):
    waiting_for_amount = State()

class MammothState(StatesGroup):
    waiting_for_balance = State()
    waiting_for_discount = State()
    target_mammoth_id = State()

class PromoState(StatesGroup):
    waiting_for_code = State()
    
class CreatePromoState(StatesGroup):
    waiting_for_name = State()
    waiting_for_percent = State()

class WorkerStartCodeState(StatesGroup):
    waiting_for_amount = State()

class WorkerPurchaseState(StatesGroup):
    waiting_for_grams = State()
    waiting_for_type = State()
    waiting_for_date = State()
    waiting_for_name = State()

class WorkerLinkMammothState(StatesGroup):
    waiting_for_id = State()

class WorkerBroadcastState(StatesGroup):
    waiting_for_message = State()
    waiting_for_mammoth_selection = State()

class WorkerCityState(StatesGroup):
    waiting_for_city_name = State()

class WorkerDistrictState(StatesGroup):
    waiting_for_city = State()
    waiting_for_district_name = State()

class WorkerProductState(StatesGroup):
    waiting_for_city = State()
    waiting_for_district = State()
    waiting_for_product = State()

class WorkerProfileState(StatesGroup):
    waiting_for_balance = State()
    waiting_for_disputes = State()
    waiting_for_date = State()

# --- HANDLERS ---

@dp.message(CommandStart())
async def cmd_start(message: Message):
    user_id = str(message.from_user.id)
    username = message.from_user.username or "Unknown"
    
    # Referral Logic
    args = message.text.split()
    referrer_id = None
    if len(args) > 1:
        # Check if it's a deep link for Mammoth Control
        if args[1].startswith("worker_"):
            referrer_id = args[1].replace("worker_", "")
        else:
            referrer_id = args[1]
        
    # Register user if new
    load_data()
    if user_id not in shop_users:
        shop_users[user_id] = {
            "username": username,
            "balance": 0,
            "discount": 0,
            "orders": 0,
            "referrer_id": referrer_id, 
            "join_date": str(message.date),
            "terms_accepted": False,
            "active_promo": None,
            "favorites": []
        }
        save_shop_users()
        
        # Notify Referrer (Worker) - only for new users
        if referrer_id:
            try:
                if bot:
                    # Specific notification for worker
                    await bot.send_message(
                        chat_id=referrer_id, 
                        text=f"ü¶£ <b>–ù–æ–≤—ã–π –º–∞–º–æ–Ω—Ç!</b>\n@{username} (ID: {user_id})\n–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: /m_{user_id}"
                    )
            except Exception as e:
                logging.error(f"Failed to notify referrer: {e}")
    # Ensure favorites field exists for existing users
    elif "favorites" not in shop_users[user_id]:
        shop_users[user_id]["favorites"] = []
        save_shop_users()

    # Send welcome emoji
    await message.answer("‚ú®")
    
    await show_main_menu(message)


@dp.callback_query(F.data == "view_menu")
async def view_menu_callback(callback: CallbackQuery):
    # Set terms accepted when user clicks accept button
    user_id = str(callback.from_user.id)
    load_data()
    if user_id in shop_users:
        shop_users[user_id]["terms_accepted"] = True
        save_shop_users()
    
    await show_main_menu(callback)

@dp.callback_query(F.data == "view_support")
async def support_callback(callback: CallbackQuery):
    await callback.answer("üí¨ –°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏: @DecepSupport\n‚è∞ –†–∞–±–æ—Ç–∞–µ–º 24/7 –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö", show_alert=True)

@dp.callback_query(F.data == "view_reviews")
async def reviews_callback(callback: CallbackQuery):
    await callback.answer("‚≠ê –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤\nüìä –í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤: 1,337\n‚≠ê –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: 4.9/5", show_alert=True)

@dp.callback_query(F.data == "view_referral")
async def referral_callback(callback: CallbackQuery):
    user_id = callback.from_user.id
    bot_info = await bot.get_me()
    ref_link = f"https://t.me/{bot_info.username}?start={user_id}"
    
    load_data()
    # Mock earnings
    earnings = 0
    
    text = (
        "üéÅ <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b> üéÅ\n\n"
        f"üîó <b>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n<code>{ref_link}</code>\n\n"
        f"üí∞ <b>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</b> {earnings} ‚ÇΩ\n\n"
        "üí° <b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>\n"
        "–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ!\n"
        "–ó–∞ –∫–∞–∂–¥–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤–∞—à–∏–º —Ä–µ—Ñ–µ—Ä–∞–ª–æ–º –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <b>10%</b> –æ—Ç —Å—É–º–º—ã –¥–µ–ø–æ–∑–∏—Ç–∞.\n\n"
        "üöÄ –ù–∞—á–Ω–∏—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!"
    )
    buttons = [[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="view_menu")]]
    
    photo_path = "images/referral.jpg"
    if not os.path.exists(photo_path): photo_path = "images/menu.jpg"
    
    try:
        if os.path.exists(photo_path):
             photo = FSInputFile(photo_path)
             await callback.message.edit_media(
                 media=types.InputMediaPhoto(media=photo, caption=text),
                 reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons)
             )
        else:
             await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
             await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
             await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

@dp.callback_query(F.data == "add_balance")
async def add_balance_callback(callback: CallbackQuery, state: FSMContext):
    text = (
        "üíé <b>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</b> üíé\n\n"
        "üí∞ –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞:\n"
        "‚ö†Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: <b>3000 ‚ÇΩ</b>"
    )
    buttons = [[InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="view_menu")]]
    
    # We need to transition to input mode. 
    # Usually editing the message is best, but we are waiting for text input.
    # We can delete/edit and ask for input.
    
    await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await state.set_state(PaymentState.waiting_for_amount)
    await callback.answer()

@dp.message(PaymentState.waiting_for_amount)
async def process_deposit_amount(message: Message, state: FSMContext):
    if not message.text or not message.text.isdigit():
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")
        return
        
    amount = int(message.text)
    if amount < 3000:
        await message.answer("‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è - 3000 RUB!")
        return

    # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤–æ—Ä–∫–µ—Ä–∞ –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞
    user_id = str(message.from_user.id)
    mammoth_username = message.from_user.username
    await notify_worker_balance_topup(user_id, amount, mammoth_username)

    await state.update_data(deposit_amount=amount)
    
    text = (
        f"üíé <b>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</b> üíé\n\n"
        f"üí∞ –°—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞: <b>{amount} ‚ÇΩ</b>\n\n"
        "üí≥ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:"
    )
    
    buttons = [
        [InlineKeyboardButton(text="üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞", callback_data="pay_method_card")],
        [InlineKeyboardButton(text="üë®‚Äçüíª –ß–µ—Ä–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞", callback_data="pay_method_operator")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="view_menu")]
    ]
    
    await message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    # We don't verify strict state here as we move to button click, but generally good practice to clear or keep state if needed.
    # Let's clear state as next steps are button presses.
    await state.clear()

@dp.callback_query(F.data == "pay_method_card")
async def pay_card_callback(callback: CallbackQuery):
    text = (
        "üí≥ <b>–û–ø–ª–∞—Ç–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π</b>\n\n"
        "üìû –î–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É.\n\n"
        "‚úÖ –ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã:\n"
        "‚Ä¢ –ü–æ–º–æ–≥—É—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–ª–∞—Ç—ë–∂\n"
        "‚Ä¢ –û—Ç–≤–µ—Ç—è—Ç –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã\n"
        "‚Ä¢ –û–±–µ—Å–ø–µ—á–∞—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n\n"
        "‚è∞ <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7</b>"
    )
    
    buttons = [
        [InlineKeyboardButton(text="üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É", url="https://t.me/DecepSupport")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="view_menu")]
    ]
    
    # Try edit
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons), disable_web_page_preview=True)
    except:
        try:
             # Just in case previous msg had media
             await callback.message.delete()
             await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons), disable_web_page_preview=True)
        except:
             pass
    await callback.answer()

@dp.callback_query(F.data == "pay_method_operator")
async def pay_operator_callback(callback: CallbackQuery):
    text = (
        "üë®‚Äçüíª <b>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</b>\n\n"
        "üìã –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.\n\n"
        "üí¨ –ö–æ–Ω—Ç–∞–∫—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞: @DecepSupport\n\n"
        "‚ö° –û–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 5-10 –º–∏–Ω—É—Ç"
    )
    
    buttons = [
         [InlineKeyboardButton(text="üí¨ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É", url="https://t.me/DecepSupport")],
         [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="view_menu")]
    ]
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

async def show_main_menu(message_input):
    # Handles both Message and CallbackQuery
    if isinstance(message_input, Message):
        msg = message_input
        edit = False
    else:
        msg = message_input.message
        edit = True
        
    text = (
        "‚ú® <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Ç–¥—ã—Ö PRO (DECEP)</b> ‚ú®\n"
        "ü§ñ @DecepShopRFbot\n\n"
        "‚ñ™Ô∏è –í –Ω–∞—à–µ–º –º–∞–≥–∞–∑–∏–Ω–µ –≤ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Ä–æ–∫–∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –≤–∞–º —Ç–æ–≤–∞—Ä.\n\n"
        "‚ñ™Ô∏è –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ.\n\n"
        "‚ñ™Ô∏è –í—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—è–π—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞. <b>–ú–´ –ù–ò–ö–û–ì–î–ê –ù–ï –ù–ê–ü–ò–®–ï–ú –ü–ï–†–í–´–ï.</b>\n\n"
        "‚ñ™Ô∏è –ï—Å–ª–∏ –≤–∞—à –Ω–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ - –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É, –º—ã –ø–æ–º–æ–∂–µ–º —Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞/–¥–æ—Å—Ç–∞–≤–∫–∏"
    )
    
    buttons = [
        [
            InlineKeyboardButton(text="üõçÔ∏è –ö–∞—Ç–∞–ª–æ–≥", callback_data="view_catalog_0"),
            InlineKeyboardButton(text="üë§ –ü—Ä–æ—Ñ–∏–ª—å", callback_data="view_profile")
        ],
        [
            InlineKeyboardButton(text="‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", callback_data="view_info"),
            InlineKeyboardButton(text="üì¶ –ó–∞–∫–∞–∑—ã", callback_data="history")
        ],
        [
            InlineKeyboardButton(text="‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ", callback_data="view_favorites"),
            InlineKeyboardButton(text="üïê –ù–µ–¥–∞–≤–Ω–∏–µ", callback_data="view_recent")
        ],
        [
            InlineKeyboardButton(text="üöö –î–æ—Å—Ç–∞–≤–∫–∞", callback_data="view_delivery"),
            InlineKeyboardButton(text="üí¨ –û–ø–µ—Ä–∞—Ç–æ—Ä", url="https://t.me/DecepSupport")
        ],
        [
            InlineKeyboardButton(text="üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å", callback_data="add_balance")
        ],
        [
            InlineKeyboardButton(text="üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞", callback_data="view_referral"),
            InlineKeyboardButton(text="üíº –†–∞–±–æ—Ç–∞", callback_data="worker")
        ]
    ]

    
    keyboard = InlineKeyboardMarkup(inline_keyboard=buttons)
    
    # Check for both logic
    photo_path = "images/menu.jpg"
    if not os.path.exists(photo_path):
        photo_path = "images/menu.png"
        
    if edit:
        # For edits, try to edit media if photo exists
        if os.path.exists(photo_path):
            try:
                photo = FSInputFile(photo_path)
                await msg.edit_media(
                    media=types.InputMediaPhoto(media=photo, caption=text),
                    reply_markup=keyboard
                )
            except:
                # If edit fails, delete and send new
                try:
                    await msg.delete()
                    photo = FSInputFile(photo_path)
                    await msg.answer_photo(photo=photo, caption=text, reply_markup=keyboard)
                except:
                    await msg.answer(text, reply_markup=keyboard)
        else:
            try:
                await msg.edit_text(text, reply_markup=keyboard)
            except:
                await msg.delete()
                await msg.answer(text, reply_markup=keyboard)
    else:
        # For new messages, send with photo if available
        if os.path.exists(photo_path):
            photo = FSInputFile(photo_path)
            await msg.answer_photo(photo=photo, caption=text, reply_markup=keyboard)
        else:
            await msg.answer(text, reply_markup=keyboard)

async def show_catalog_page(callback: CallbackQuery, page: int):
    cities = list(SHOP_DATA.keys())
    ITEMS_PER_PAGE = 15  # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 4 –¥–æ 15 –≥–æ—Ä–æ–¥–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    start_idx = page * ITEMS_PER_PAGE
    end_idx = start_idx + ITEMS_PER_PAGE
    current_cities = cities[start_idx:end_idx]
    
    buttons = []
    
    # Cities Grid (2 per row)
    city_row = []
    for city in current_cities:
        city_row.append(InlineKeyboardButton(text=f"üèôÔ∏è {city}", callback_data=f"city_{city}"))
        if len(city_row) == 2:  # 2 –≥–æ—Ä–æ–¥–∞ –≤ —Ä—è–¥
            buttons.append(city_row)
            city_row = []
    if city_row:
        buttons.append(city_row)
    
    # Navigation
    nav_row = []
    if page > 0:
        nav_row.append(InlineKeyboardButton(text="‚¨ÖÔ∏è", callback_data=f"view_catalog_{page-1}"))
    
    # Page indicator
    total_pages = (len(cities) + ITEMS_PER_PAGE - 1) // ITEMS_PER_PAGE
    if total_pages > 1:
        nav_row.append(InlineKeyboardButton(text=f"üìÑ {page+1}/{total_pages}", callback_data="ignore"))

    if end_idx < len(cities):
        nav_row.append(InlineKeyboardButton(text="‚û°Ô∏è", callback_data=f"view_catalog_{page+1}"))
    
    if nav_row:
        buttons.append(nav_row)
        
    buttons.append([InlineKeyboardButton(text="üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="view_menu")])

    text = "üåÜ <b>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥:</b>\n\nüìç –î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏:"
    
    photo_path = "images/catalog.jpg"
    if not os.path.exists(photo_path):
        photo_path = "images/catalog.png"
    try:
        if os.path.exists(photo_path):
            photo = FSInputFile(photo_path)
            await callback.message.edit_media(
                media=types.InputMediaPhoto(media=photo, caption=text),
                reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons)
            )
        else:
            await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        # If edit fails, delete and send new
        try:
            await callback.message.delete()
            if os.path.exists(photo_path):
                photo = FSInputFile(photo_path)
                await callback.message.answer_photo(photo=photo, caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
            else:
                await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
            pass
    
    try:
        await callback.answer()
    except:
        pass

# --- WORKER HANDLERS ---

@dp.message(Command("worker"))
async def worker_panel(message: Message):
    user_id = str(message.from_user.id)
    username = message.from_user.username or "Unknown"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(user_id):
        log_security_event("UNAUTHORIZED_ACCESS", user_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ worker –ø–∞–Ω–µ–ª–∏")
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.")
        return
    bot_info = await bot.get_me()
    ref_link = f"https://t.me/{bot_info.username}?start=worker_{user_id}"
    
    load_data()
    
    text = (
        f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, Worker{user_id}\n\n"
        f"üÜî <b>ID:</b> {user_id}\n"
        f"üë§ <b>Username:</b> @{username}\n\n"
        f"üîó <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n<code>{ref_link}</code>\n\n"
        f"‚ö†Ô∏è –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–∞–º–æ–Ω—Ç–∞ –±–µ–∑ —Ä–µ—Ñ. —Å—Å—ã–ª–∫–∏, –≤–∞—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É –Ω–µ–≥–æ –Ω–µ –±—É–¥–µ—Ç.\n\n"
        f"‚ùì –ß—Ç–æ–±—ã —É –º–∞–º–æ–Ω—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É —Ä–µ—Ñ. —Å—Å—ã–ª–∫—É/–ª–∏–±–æ –ø—Ä–∏–≤—è–∂–∏—Ç–µ —á–µ—Ä–µ–∑ ID."
    )
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚≠ê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞–º–∏", callback_data="worker_startcodes")],
        [InlineKeyboardButton(text="üõí –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é", callback_data="worker_add_purchase")],
        [InlineKeyboardButton(text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏", callback_data="worker_delete_purchases")],
        [
            InlineKeyboardButton(text="ü¶£ –ú–æ–∏ –º–∞–º–æ–Ω—Ç—ã", callback_data="my_mammoths"),
            InlineKeyboardButton(text="üîó –ü—Ä–∏–≤—è–∑–∞—Ç—å –º–∞–º–æ–Ω—Ç–∞ –ø–æ ID", callback_data="worker_link_mammoth")
        ],
        [InlineKeyboardButton(text="üì¢ –†–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –º–∞–º–æ–Ω—Ç–∞–º", callback_data="worker_broadcast")],
        [
            InlineKeyboardButton(text="üèôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤", callback_data="worker_cities"),
            InlineKeyboardButton(text="üìç –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–π–æ–Ω–æ–≤", callback_data="worker_districts")
        ],
        [
            InlineKeyboardButton(text="üì¶ –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ —Ä–∞–π–æ–Ω–µ", callback_data="worker_products_district"),
            InlineKeyboardButton(text="üõçÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä—ã", callback_data="worker_products")
        ],
        [
            InlineKeyboardButton(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å", callback_data="worker_profile"),
            InlineKeyboardButton(text="‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥", callback_data="worker_config")
        ]
    ])
    
    await message.answer(text, reply_markup=keyboard)

@dp.callback_query(F.data == "worker_panel")
async def worker_panel_callback(callback: CallbackQuery):
    user_id = str(callback.from_user.id)
    username = callback.from_user.username or "Unknown"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(user_id):
        log_security_event("UNAUTHORIZED_ACCESS", user_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ worker –ø–∞–Ω–µ–ª–∏ —á–µ—Ä–µ–∑ callback")
        await callback.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.", show_alert=True)
        return
    bot_info = await bot.get_me()
    ref_link = f"https://t.me/{bot_info.username}?start=worker_{user_id}"
    
    load_data()
    
    text = (
        f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, Worker{user_id}\n\n"
        f"üÜî <b>ID:</b> {user_id}\n"
        f"üë§ <b>Username:</b> @{username}\n\n"
        f"üîó <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n<code>{ref_link}</code>\n\n"
        f"‚ö†Ô∏è –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–∞–º–æ–Ω—Ç–∞ –±–µ–∑ —Ä–µ—Ñ. —Å—Å—ã–ª–∫–∏, –≤–∞—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É –Ω–µ–≥–æ –Ω–µ –±—É–¥–µ—Ç.\n\n"
        f"‚ùì –ß—Ç–æ–±—ã —É –º–∞–º–æ–Ω—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É —Ä–µ—Ñ. —Å—Å—ã–ª–∫—É/–ª–∏–±–æ –ø—Ä–∏–≤—è–∂–∏—Ç–µ —á–µ—Ä–µ–∑ ID."
    )
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚≠ê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞–º–∏", callback_data="worker_startcodes")],
        [InlineKeyboardButton(text="üõí –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é", callback_data="worker_add_purchase")],
        [InlineKeyboardButton(text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏", callback_data="worker_delete_purchases")],
        [
            InlineKeyboardButton(text="ü¶£ –ú–æ–∏ –º–∞–º–æ–Ω—Ç—ã", callback_data="my_mammoths"),
            InlineKeyboardButton(text="üîó –ü—Ä–∏–≤—è–∑–∞—Ç—å –º–∞–º–æ–Ω—Ç–∞ –ø–æ ID", callback_data="worker_link_mammoth")
        ],
        [InlineKeyboardButton(text="üì¢ –†–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –º–∞–º–æ–Ω—Ç–∞–º", callback_data="worker_broadcast")],
        [
            InlineKeyboardButton(text="üèôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤", callback_data="worker_cities"),
            InlineKeyboardButton(text="üìç –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–π–æ–Ω–æ–≤", callback_data="worker_districts")
        ],
        [
            InlineKeyboardButton(text="üì¶ –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ —Ä–∞–π–æ–Ω–µ", callback_data="worker_products_district"),
            InlineKeyboardButton(text="üõçÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä—ã", callback_data="worker_products")
        ],
        [
            InlineKeyboardButton(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å", callback_data="worker_profile"),
            InlineKeyboardButton(text="‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥", callback_data="worker_config")
        ]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

@dp.callback_query(F.data == "my_mammoths")
async def my_mammoths_handler(callback: CallbackQuery):
    user_id = str(callback.from_user.id)
    load_data()
    
    # Find all users where referrer_id == current user
    mammoths = []
    for uid, data in shop_users.items():
        if str(data.get("referrer_id")) == user_id:
            mammoths.append((uid, data.get("username", "Unknown"), data.get("balance", 0)))
            
    if not mammoths:
        await callback.answer("–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –º–∞–º–æ–Ω—Ç–æ–≤.", show_alert=True)
        return
        
    text = "ü¶£ <b>–¢–≤–æ–∏ –º–∞–º–æ–Ω—Ç—ã:</b>\n\n"
    for uid, uname, bal in mammoths:
        text += f"üë§ @{uname}\nüÜî ID: <code>{uid}</code>\nüí∞ –ë–∞–ª–∞–Ω—Å: {bal} ‚ÇΩ\nüëâ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: /m_{uid}\n\n"
        
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_panel")]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)

# --- MAMMOTH CONTROL HANDLER ---
@dp.message(lambda message: message.text and message.text.startswith("/m_"))
async def mammoth_control(message: Message, state: FSMContext):
    worker_id = str(message.from_user.id)
    
    try:
        target_id = str(message.text.split("_")[1])
    except IndexError:
        await message.answer("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã use /m_ID")
        return
        
    load_data()
    
    # Validation: Only allow if worker is referrer OR admin
    if target_id not in shop_users:
        await message.answer("‚ùå –ú–∞–º–æ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ.")
        return
        
    target_data = shop_users[target_id]
    
    # Permission check
    is_referrer = str(target_data.get("referrer_id")) == worker_id
    is_admin = int(worker_id) == ADMIN_ID
    is_authorized_worker = is_worker_authorized(worker_id)
    
    if not (is_referrer or is_admin or is_authorized_worker):
        username = message.from_user.username or "Unknown"
        log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, f"–ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞–º–æ–Ω—Ç—É {target_id}")
        await message.answer("‚ùå –≠—Ç–æ –Ω–µ —Ç–≤–æ–π –º–∞–º–æ–Ω—Ç!")
        return
        
    current_promo = target_data.get("active_promo")
    promo_text = f"{current_promo} ({promocodes.get(current_promo)}%)" if current_promo else "–ù–µ—Ç"
    
    text = (
        f"ü¶£ <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ú–∞–º–æ–Ω—Ç–æ–º</b> ü¶£\n\n"
        f"üë§ –Æ–∑–µ—Ä: @{target_data.get('username')}\n"
        f"üÜî ID: <code>{target_id}</code>\n"
        f"üí∞ –ë–∞–ª–∞–Ω—Å: {target_data.get('balance')} ‚ÇΩ\n"
        f"üéü –ü—Ä–æ–º–æ–∫–æ–¥: {promo_text}\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
    )
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚≠ê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞–º–∏", callback_data="worker_startcodes")],
        [InlineKeyboardButton(text="üõí –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é", callback_data="worker_add_purchase")],
        [InlineKeyboardButton(text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏", callback_data="worker_delete_purchases")],
        [
            InlineKeyboardButton(text="ü¶£ –ú–æ–∏ –º–∞–º–æ–Ω—Ç—ã", callback_data="my_mammoths"),
            InlineKeyboardButton(text="üîó –ü—Ä–∏–≤—è–∑–∞—Ç—å –º–∞–º–æ–Ω—Ç–∞ –ø–æ ID", callback_data="worker_link_mammoth")
        ],
        [InlineKeyboardButton(text="üì¢ –†–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –º–∞–º–æ–Ω—Ç–∞–º", callback_data="worker_broadcast")],
        [
            InlineKeyboardButton(text="üèôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤", callback_data="worker_cities"),
            InlineKeyboardButton(text="üìç –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–π–æ–Ω–æ–≤", callback_data="worker_districts")
        ],
        [
            InlineKeyboardButton(text="üì¶ –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ —Ä–∞–π–æ–Ω–µ", callback_data="worker_products_district"),
            InlineKeyboardButton(text="üõçÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä—ã", callback_data="worker_products")
        ],
        [
            InlineKeyboardButton(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å", callback_data="worker_profile"),
            InlineKeyboardButton(text="‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥", callback_data="worker_config")
        ],
        [
            InlineKeyboardButton(text="üí∞ –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å", callback_data=f"set_balance_{target_id}"),
            InlineKeyboardButton(text="üéü –í—ã–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥", callback_data=f"give_personal_promo_{target_id}")
        ],
        [InlineKeyboardButton(text="‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ", callback_data=f"send_fake_msg_{target_id}")],
        [InlineKeyboardButton(text="‚ùå –ó–∞–∫—Ä—ã—Ç—å", callback_data="close_panel")]
    ])
    
    await message.answer(text, reply_markup=keyboard)

@dp.callback_query(F.data == "close_panel")
async def close_panel(callback: CallbackQuery):
    await callback.message.delete()

# --- BALANCE SETTING ---
@dp.callback_query(F.data.startswith("set_balance_"))
async def ask_balance(callback: CallbackQuery, state: FSMContext):
    target_id = str(callback.data.split("_")[2])
    await state.update_data(target_mammoth_id=target_id)
    
    await callback.message.answer("üí∞ <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</b>\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –º–∞–º–æ–Ω—Ç–∞ (—á–∏—Å–ª–æ):")
    await state.set_state(MammothState.waiting_for_balance)
    await callback.answer()

@dp.message(MammothState.waiting_for_balance)
async def process_balance_change(message: Message, state: FSMContext):
    if not message.text or not message.text.isdigit():
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")
        return
    
    worker_id = str(message.from_user.id)
    username = message.from_user.username or "Unknown"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(worker_id):
        log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞")
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.")
        await state.clear()
        return
        
    new_balance = int(message.text)
    data = await state.get_data()
    target_id = data.get("target_mammoth_id")
    
    if not target_id:
        await message.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω ID –º–∞–º–æ–Ω—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
        await state.clear()
        return
    
    target_id = str(target_id)  # –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
    load_data()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —ç—Ç–æ–≥–æ –º–∞–º–æ–Ω—Ç–∞
    if target_id in shop_users:
        mammoth_data = shop_users[target_id]
        is_referrer = str(mammoth_data.get("referrer_id")) == worker_id
        is_admin = int(worker_id) == ADMIN_ID
        
        if not (is_referrer or is_admin or is_worker_authorized(worker_id)):
            log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, f"–ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –º–∞–º–æ–Ω—Ç–∞ {target_id}")
            await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —ç—Ç–æ–≥–æ –º–∞–º–æ–Ω—Ç–∞.")
            await state.clear()
            return
    
    if target_id in shop_users:
        # –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —Å–ª–æ–≤–∞—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
        if not isinstance(shop_users[target_id], dict):
            shop_users[target_id] = {}
        shop_users[target_id]["balance"] = new_balance
        save_shop_users()
        
        # Notify mammoth? Maybe fake deposit success
        try:
            await bot.send_message(int(target_id), f"‚úÖ –í–∞—à –±–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ {new_balance} ‚ÇΩ")
        except (TelegramForbiddenError, TelegramBadRequest) as e:
            # –ú–∞–º–æ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
            mammoth_username = shop_users[target_id].get("username")
            await notify_worker_mammoth_blocked(target_id, mammoth_username)
        except Exception as e:
            logging.error(f"Error sending message to mammoth: {e}")
            pass
            
        await message.answer(f"‚úÖ –ë–∞–ª–∞–Ω—Å –º–∞–º–æ–Ω—Ç–∞ {target_id} –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ {new_balance} ‚ÇΩ")
    else:
        await message.answer("‚ùå –ú–∞–º–æ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
        
    await state.clear()

# --- GLOBAL PROMO CREATION ---
@dp.callback_query(F.data == "create_global_promo")
async def create_promo_start(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("üéü <b>–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞</b>\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, SALE20):")
    await state.set_state(CreatePromoState.waiting_for_name)
    await callback.answer()

@dp.message(CreatePromoState.waiting_for_name)
async def process_promo_name(message: Message, state: FSMContext):
    code_name = message.text.upper()
    await state.update_data(code_name=code_name)
    await message.answer("üìâ <b>–ü—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏</b>\n\n–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏ (–æ—Ç 1 –¥–æ 100):")
    await state.set_state(CreatePromoState.waiting_for_percent)

@dp.message(CreatePromoState.waiting_for_percent)
async def process_promo_percent(message: Message, state: FSMContext):
    if not message.text or not message.text.isdigit():
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")
        return
        
    percent = int(message.text)
    if percent < 1 or percent > 100:
        await message.answer("‚ùå –ü—Ä–æ—Ü–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 100")
        return
        
    data = await state.get_data()
    code_name = data.get("code_name")
    
    # Save promo
    load_data()
    promocodes[code_name] = percent
    save_promocodes()
    
    await message.answer(f"‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ <b>{code_name}</b> –Ω–∞ <b>{percent}%</b> —Å–æ–∑–¥–∞–Ω!")
    await state.clear()


# --- PERSONAL PROMO (VIA MAMMOTH PANEL) ---
@dp.callback_query(F.data.startswith("give_personal_promo_"))
async def give_personal_promo(callback: CallbackQuery, state: FSMContext):
    worker_id = str(callback.from_user.id)
    username = callback.from_user.username or "Unknown"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(worker_id):
        log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –≤—ã–¥–∞—á–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞")
        await callback.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.", show_alert=True)
        return
    
    target_id = str(callback.data.split("_")[3]) # give_personal_promo_ID
    
    await state.update_data(target_mammoth_id=target_id) 
    
    await callback.message.answer(f"üéü <b>–õ–∏—á–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥</b>\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–ª—è ID {target_id} (–Ω–∞–ø—Ä–∏–º–µ—Ä, PERSONAL30):")
    await state.set_state(CreatePromoState.waiting_for_name)
    await callback.answer()

# --- FAKE MESSAGE HANDLER ---
class FakeMessageState(StatesGroup):
    waiting_for_text = State()

@dp.callback_query(F.data.startswith("send_fake_msg_"))
async def send_fake_msg_ask(callback: CallbackQuery, state: FSMContext):
    worker_id = str(callback.from_user.id)
    username = callback.from_user.username or "Unknown"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(worker_id):
        log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –º–∞–º–æ–Ω—Ç—É")
        await callback.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.", show_alert=True)
        return
    
    # send_fake_msg_ID -> ['send', 'fake', 'msg', 'ID']
    target_id = str(callback.data.split("_")[3])
    await state.update_data(target_mammoth_id=target_id)
    
    await callback.message.answer("‚úâÔ∏è <b>–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</b>\n\n–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –º–∞–º–æ–Ω—Ç–∞:")
    await state.set_state(FakeMessageState.waiting_for_text)
    await callback.answer()

@dp.message(FakeMessageState.waiting_for_text)
async def process_fake_msg(message: Message, state: FSMContext):
    if not message.text:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è!")
        return
    
    worker_id = str(message.from_user.id)
    username = message.from_user.username or "Unknown"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(worker_id):
        log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –º–∞–º–æ–Ω—Ç—É")
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.")
        await state.clear()
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–∞–º
    if check_spam_content(message.text):
        log_security_event("SPAM_DETECTED", worker_id, username, f"–û–±–Ω–∞—Ä—É–∂–µ–Ω —Å–ø–∞–º –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏: {message.text[:100]}")
        await message.answer("‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞.")
        await state.clear()
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è
    if len(message.text) > MAX_MESSAGE_LENGTH:
        await message.answer(f"‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ. –ú–∞–∫—Å–∏–º—É–º {MAX_MESSAGE_LENGTH} —Å–∏–º–≤–æ–ª–æ–≤.")
        await state.clear()
        return
    
    data = await state.get_data()
    target_id = data.get("target_mammoth_id")
    
    msg_text = (
        f"{message.text}\n\n"
        f"<b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è Decep Shop ( –û–¢–î–´–• )</b>"
    )
    
    try:
        await bot.send_message(chat_id=target_id, text=msg_text)
        await message.answer(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –º–∞–º–æ–Ω—Ç—É {target_id}!")
    except (TelegramForbiddenError, TelegramBadRequest) as e:
        # –ú–∞–º–æ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
        load_data()
        mammoth_username = shop_users.get(target_id, {}).get("username")
        await notify_worker_mammoth_blocked(target_id, mammoth_username)
        await message.answer(f"‚ùå –ú–∞–º–æ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞. –í–æ—Ä–∫–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω.")
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {str(e)}")
        
    await state.clear()

# --- ENTER PROMO (USER SIDE) ---
@dp.callback_query(F.data == "enter_promo")
async def enter_promo_callback(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("üéü <b>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</b>\n\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø—Ä–æ–º–æ–∫–æ–¥:")
    await state.set_state(PromoState.waiting_for_code)
    await callback.answer()

@dp.message(PromoState.waiting_for_code)
async def process_promo_code(message: Message, state: FSMContext):
    code = message.text.upper()
    user_id = str(message.from_user.id)
    
    load_data()
    if code in promocodes:
        percent = promocodes[code]
        
        if user_id in shop_users:
            shop_users[user_id]["active_promo"] = code
            save_shop_users()
            
        await message.answer(f"‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ <b>{code}</b> –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!\nüéü –í–∞—à–∞ —Å–∫–∏–¥–∫–∞: <b>{percent}%</b>")
    else:
        await message.answer("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ –∏–ª–∏ –æ–Ω –∏—Å—Ç–µ–∫.\nüí¨ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.")
        
    await state.clear()

# --- Updated get_discounted_price helper ---
def get_discounted_price(user_id, original_price):
    user_data = shop_users.get(str(user_id), {})
    promo_code = user_data.get("active_promo")
    
    discount = 0
    if promo_code and promo_code in promocodes:
        discount = promocodes[promo_code]
        
    # User asked for price adjustment if promo entered.
    if discount > 0:
        new_price = int(original_price * (1 - discount / 100))
        return new_price, discount
    return original_price, 0

# ... (Existing Handlers) ...

# UPDATE: Modify show_main_menu to include "Enter Promo" button? 
# or put it in Profile. Let's add it to Profile and create a "Worker" entry in Main Menu

@dp.callback_query(F.data == "view_profile")
async def profile_callback(callback: CallbackQuery):
    user_id = str(callback.from_user.id)
    username = callback.from_user.username or "–ê–Ω–æ–Ω–∏–º"
    
    load_data()
    user_info = shop_users.get(user_id, {"balance": 0, "orders": 0, "discount": 0})
    
    # Calculate discount
    active_promo = user_info.get("active_promo")
    promo_text = f"{active_promo} ({promocodes.get(active_promo)}%)" if active_promo and active_promo in promocodes else "–ù–µ—Ç"
    
    text = (
        f"üë§ <b>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</b> üë§\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
        f"üîπ –õ–æ–≥–∏–Ω: @{username}\n"
        f"üîπ ID: <code>{user_id}</code>\n"
        f"üîπ –ó–∞–∫–∞–∑–æ–≤: {user_info.get('orders', 0)}\n"
        f"üîπ –î–∏—Å–ø—É—Ç—ã: 0\n"
        f"üîπ –ü—Ä–æ–º–æ–∫–æ–¥: {promo_text}\n\n"
        f"üí∞ <b>–ë–∞–ª–∞–Ω—Å: {user_info.get('balance', 0)} ‚ÇΩ</b>\n\n"
        f"üìÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {user_info.get('join_date', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ').split(' ')[0]}\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
    )
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å", callback_data="add_balance")],
        [InlineKeyboardButton(text="üéü –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥", callback_data="enter_promo")],
        [InlineKeyboardButton(text="üìú –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤", callback_data="history")],
        [InlineKeyboardButton(text="üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="view_menu")]
    ])
    
    # ... (Rest of existing image handling logic) ...
    photo_path = "images/profile.jpg"
    if not os.path.exists(photo_path):
        photo_path = "images/profile.png"
    
    try:
        if os.path.exists(photo_path):
            photo = FSInputFile(photo_path)
            await callback.message.edit_media(media=types.InputMediaPhoto(media=photo, caption=text), reply_markup=keyboard)
        else:
            try:
                await callback.message.edit_text(text, reply_markup=keyboard)
            except:
                await callback.message.edit_caption(caption=text, reply_markup=keyboard)
    except:
        try:
             await callback.message.delete()
        except:
             pass
        if os.path.exists(photo_path):
            photo = FSInputFile(photo_path)
            await callback.message.answer_photo(photo=photo, caption=text, reply_markup=keyboard)
        else:
             await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

# UPDATE: Update product_callback to show discounted price
@dp.callback_query(F.data.startswith("prod_"))
async def product_callback(callback: CallbackQuery):
    # prod_City_Dist_Category_Index
    parts = callback.data.split("_")
    city_name = parts[1]
    district_name = parts[2]
    cat_key = parts[3]
    prod_idx = int(parts[4])
    
    product = PRODUCTS[cat_key][prod_idx]
    
    # Calculate Price
    user_id = callback.from_user.id
    final_price, discount = get_discounted_price(user_id, product['price'])
    
    price_str = f"{product['price']}‚ÇΩ"
    if discount > 0:
        price_str = f"<s>{product['price']}‚ÇΩ</s> <b>{final_price}‚ÇΩ</b> (-{discount}%)"
    
    desc = product.get("desc", "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.")
    p_type = product.get("type", "–¢–∞–π–Ω–∏–∫")
    
    text = (
        f"üõçÔ∏è <b>{product['name']}</b>\n\n"
        f"üìù <i>{desc}</i>\n\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
        f"üèôÔ∏è <b>–ì–æ—Ä–æ–¥:</b> {city_name}\n"
        f"üìç <b>–†–∞–π–æ–Ω:</b> {district_name}\n"
        f"üì¶ <b>–í–µ—Å:</b> {product['weight']}\n"
        f"üéØ <b>–¢–∏–ø:</b> {p_type}\n"
        f"üí∞ <b>–¶–µ–Ω–∞:</b> {price_str}\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
    )
    
    # Check if product is in favorites
    user_id_str = str(callback.from_user.id)
    load_data()
    user_favorites = shop_users.get(user_id_str, {}).get("favorites", [])
    fav_key = f"{city_name}|||{district_name}|||{cat_key}|||{prod_idx}"
    is_favorite = fav_key in user_favorites
    
    buttons = [
        [InlineKeyboardButton(text="‚úÖ –ö—É–ø–∏—Ç—å", callback_data=f"prebuy_{city_name}_{district_name}_{cat_key}_{prod_idx}")],
        [
            InlineKeyboardButton(
                text="‚ùå –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ" if is_favorite else "‚≠ê –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ", 
                callback_data=f"fav_{city_name}_{district_name}_{cat_key}_{prod_idx}"
            ),
            InlineKeyboardButton(text="üÜö –°—Ä–∞–≤–Ω–∏—Ç—å", callback_data=f"compare_{cat_key}_{prod_idx}")
        ],
        [
            InlineKeyboardButton(text="üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Å–Ω–∏–∂–µ–Ω–∏–∏ —Ü–µ–Ω—ã", callback_data=f"notify_price_{cat_key}_{prod_idx}"),
        ],
        [
            InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=f"cat_{city_name}_{district_name}_{cat_key}"),
            InlineKeyboardButton(text="üè† –ú–µ–Ω—é", callback_data="view_menu")
        ]
    ]
    
    # ... (Image handling same as before) ...
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
             await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
             try:
                 await callback.message.delete()
                 await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
             except:
                 pass
    
    await callback.answer()

@dp.callback_query(F.data.startswith("prebuy_"))
async def prebuy_callback(callback: CallbackQuery):
    # prebuy_City_Dist_Category_Index
    parts = callback.data.split("_")
    cat_key = parts[3]
    prod_idx = int(parts[4])
    
    product = PRODUCTS[cat_key][prod_idx]
    
    # Calculate Price
    user_id = callback.from_user.id
    final_price, discount = get_discounted_price(user_id, product['price'])
    
    text = (
        f"üí≥ <b>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</b>\n\n"
        f"üí∞ –°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ: <b>{final_price} ‚ÇΩ</b>\n"
        f"{f'üéü –°–∫–∏–¥–∫–∞: {discount}%' if discount > 0 else ''}"
    )
    
    buttons = [
        [InlineKeyboardButton(text=f"‚Çø Bitcoin (BTC) - {final_price}‚ÇΩ", callback_data=f"pay_BTC_{final_price}")],
        [InlineKeyboardButton(text=f"≈Å LiteCoin (LTC) - {final_price}‚ÇΩ", callback_data=f"pay_LTC_{final_price}")],
        [InlineKeyboardButton(text=f"üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ - {final_price}‚ÇΩ", callback_data=f"pay_Card_{final_price}")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=callback.data.replace("prebuy_", "prod_"))]
    ]
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

@dp.callback_query(F.data.startswith("fav_"))
async def add_fav_callback(callback: CallbackQuery):
    # fav_City_District_Category_Index
    # Format: fav_{city}_{district}_{category}_{index}
    # Note: city and district names may contain spaces/hyphens but callback_data uses _ as separator
    data_parts = callback.data[4:].split("_")  # Remove "fav_" prefix (4 chars) and split by _
    
    if len(data_parts) < 4:
        await callback.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ", show_alert=True)
        return
    
    # Structure: city_district_category_index (all separated by _)
    # Even if city/district has spaces in display name, in callback_data they're single tokens
    city_name = data_parts[0]
    district_name = data_parts[1]
    cat_key = data_parts[2]
    prod_idx = int(data_parts[3])
    
    user_id = str(callback.from_user.id)
    load_data()
    
    if user_id not in shop_users:
        shop_users[user_id] = {"favorites": []}
    
    if "favorites" not in shop_users[user_id]:
        shop_users[user_id]["favorites"] = []
    
    # Use a separator that won't appear in city/district names
    fav_key = f"{city_name}|||{district_name}|||{cat_key}|||{prod_idx}"
    favorites = shop_users[user_id]["favorites"]
    
    if fav_key in favorites:
        # Remove from favorites
        favorites.remove(fav_key)
        message_text = "‚ùå –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
    else:
        # Add to favorites
        favorites.append(fav_key)
        message_text = "‚≠ê –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!"
    
    save_shop_users()
    await callback.answer(message_text, show_alert=False)
    
    # Update the product page to reflect the change
    # Create a new callback data with prod_ prefix to reload the product page
    original_data = callback.data
    callback.data = f"prod_{city_name}_{district_name}_{cat_key}_{prod_idx}"
    try:
        await product_callback(callback)
    except:
        # If update fails, restore original data
        callback.data = original_data

@dp.callback_query(F.data.startswith("compare_"))
async def compare_callback(callback: CallbackQuery):
    await callback.answer("üÜö –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é!", show_alert=False)

@dp.callback_query(F.data.startswith("notify_"))
async def notify_callback(callback: CallbackQuery):
    action = callback.data.split("_")[1] # price or stock
    if action == "price":
        await callback.answer("üîî –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ü–µ–Ω–∞ —Å–Ω–∏–∑–∏—Ç—Å—è –Ω–∞ 10-20%", show_alert=True)
    else:
        await callback.answer("üîî –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä –ø–æ—è–≤–∏—Ç—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏", show_alert=True)

# --- WORKER & VACANCIES ---

@dp.callback_query(F.data == "worker")
async def worker_callback(callback: CallbackQuery):
    text = (
        "üíº <b>–†–∞–±–æ—Ç–∞ –≤ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ</b> üíº\n\n"
        "üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏:\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é –≤–∞—Å –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."
    )
    
    buttons = [
        [
            InlineKeyboardButton(text="üèÉ –ö—É—Ä—å–µ—Ä", callback_data="vac_courier"),
            InlineKeyboardButton(text="üñº –¢—Ä–∞—Ñ–∞—Ä–µ—Ç—á–∏–∫", callback_data="vac_stencil"),
            InlineKeyboardButton(text="üöõ –í–æ–¥–∏—Ç–µ–ª—å", callback_data="vac_driver")
        ],
        [
            InlineKeyboardButton(text="üì∞ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è", callback_data="vac_verification"),
            InlineKeyboardButton(text="üë®‚Äçüíª –û–ø–µ—Ä–∞—Ç–æ—Ä", callback_data="vac_operator")
        ],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="view_menu")]
    ]
    
    # Try different photos if available, or just keeping the menu photo or changing it?
    # The screenshot shows a specific image for work. Let's try to use 'work.jpg' if it exists, else menu image.
    photo_path = "images/work.jpg" 
    if not os.path.exists(photo_path):
        photo_path = "images/menu.jpg"
        
    try:
        if os.path.exists(photo_path):
             # Force new photo if switching from menu to work
            photo = FSInputFile(photo_path)
            await callback.message.edit_media(
                media=types.InputMediaPhoto(media=photo, caption=text),
                reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons)
            )
        else:
             await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
            await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
             await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
             
    await callback.answer()

@dp.callback_query(F.data == "vac_courier")
async def vac_courier(callback: CallbackQuery):
    text = (
        "üèÉ‚Äç‚ôÇÔ∏è <b>–ö—É—Ä—å–µ—Ä</b> üèÉ‚Äç‚ôÇÔ∏è\n\n"
        "–°—É—Ç—å —Ä–∞–±–æ—Ç—ã - ¬´—Ä–∞—Å–∫–ª–∞–¥–∫–∞¬ª –ø–æ–∑–∏—Ü–∏–π –ø–æ –≤—ã–¥–∞–Ω–Ω–æ–º—É —Ä–∞–π–æ–Ω—É.\n\n"
        "‚ñ™Ô∏è –ú—ã –ø–ª–∞—Ç–∏–º –∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞, –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –æ–∂–∏–¥–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –∫–ª–∞–¥–∞.\n"
        "‚ñ™Ô∏è –û–ø–ª–∞—Ç–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –¥–µ–Ω—å –≤ –¥–µ–Ω—å.\n"
        "‚ñ™Ô∏è –ü—Ä–µ–º–∏–∏ –∏ –±–æ–Ω—É—Å—ã —Å—Ä–µ–¥–∏ –∫—É—Ä—å–µ—Ä–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑—É—é—Ç—Å—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ.\n"
        "‚ñ™Ô∏è –ö–æ–Ω–∫—É—Ä—Å—ã —Å—Ä–µ–¥–∏ –∫—É—Ä—å–µ—Ä–æ–≤ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞.\n"
        "‚ñ™Ô∏è –ú—ã –æ–±–ª–∞–¥–∞–µ–º –æ–≥—Ä–æ–º–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ —Å–æ —Å—Ç–∞–∂–µ–º —Ä–∞–±–æ—Ç—ã –±–æ–ª–µ–µ –ø—è—Ç–∏ –ª–µ—Ç.\n"
        "‚ñ™Ô∏è –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —á–∞—Ç –¥–ª—è –∫—É—Ä—å–µ—Ä–æ–≤, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –æ–ø—ã—Ç–æ–º —Å –¥—Ä—É–≥–∏–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏.\n\n"
        "<i>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ –∑–∞–ª–æ–≥—É –æ—Ç 3000‚ÇΩ. –î–ª—è –Ω–∞—á–∞–ª–∞ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≥–æ—Ä–æ–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.</i>"
    )
    buttons = [[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker")]]
    await _edit_vacancy_text(callback, text, buttons)

@dp.callback_query(F.data == "vac_stencil")
async def vac_stencil(callback: CallbackQuery):
    text = (
        "ÔøΩ <b>–¢—Ä–∞—Ñ–∞—Ä–µ—Ç—á–∏–∫</b> üñº\n\n"
        "–°—É—Ç—å —Ä–∞–±–æ—Ç—ã - –Ω–∞–Ω–µ—Å–µ–Ω–∏–µ —Ä–∏—Å—É–Ω–∫–∞/–Ω–∞–∫–ª–µ–π–∫–∏ –Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏–º—ã–µ –º–µ—Å—Ç–∞, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏/—Å—Ç–∏–∫–µ—Ä–∞ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ NoteCam\n\n"
        "‚ñ™Ô∏è –û–ø–ª–∞—Ç–∞ –æ—Ç 110‚ÇΩ –∑–∞ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏.\n"
        "‚ñ™Ô∏è –û–ø–ª–∞—Ç–∞ –æ—Ç 50‚ÇΩ –∑–∞ —Å—Ç–∏–∫–µ—Ä.\n"
        "‚ñ™Ô∏è –í—ã–ø–ª–∞—Ç–∞ –æ—Ç 20 –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏ / 50 —Å—Ç–∏–∫–µ—Ä–æ–≤.\n"
        "‚ñ™Ô∏è –¢–µ–∫—Å—Ç –¥–ª—è –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏ –≤—ã–¥–∞—Å—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä.\n"
        "‚ñ™Ô∏è –ß–µ–∫ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫—Ä–∞—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ, –º—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –Ω–µ—ë –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–µ—Ä–≤–æ–π –ó–ü.\n\n"
        "<i>–î–ª—è –Ω–∞—á–∞–ª–∞ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≥–æ—Ä–æ–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É, –ø–æ–ª—É—á–∏—Ç–µ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∫—É–ø–∏—Ç–µ –±–∞–ª–ª–æ–Ω —Å –∫—Ä–∞—Å–∫–æ–π.</i>"
    )
    buttons = [[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker")]]
    await _edit_vacancy_text(callback, text, buttons)

@dp.callback_query(F.data == "vac_driver")
async def vac_driver(callback: CallbackQuery):
    text = (
        "üöõ <b>–í–æ–¥–∏—Ç–µ–ª—å</b> üöõ\n\n"
        "–°—É—Ç—å —Ä–∞–±–æ—Ç—ã - –ø–µ—Ä–µ–≤–æ–∑–∫–∞ —Ç–æ–≤–∞—Ä–∞ (—Ö–∏–º.–≤–µ—â–µ—Å—Ç–≤ –Ω–µ–ª–µ–≥–∞–ª—å–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –º–µ–∂–¥—É –≥–æ—Ä–æ–¥–∞–º–∏)\n\n"
        "–ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω, —Ä–µ–π—Å—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è, –ó–ü –æ—Ç 70000‚ÇΩ –∑–∞ —Ä–µ–π—Å, —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º –≤–µ—Å–æ–º..\n"
        "‚ñ™Ô∏è –í—Å–µ —Ä–∞—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ (–ì–°–ú, –∞—Ä–µ–Ω–¥–∞ –∂–∏–ª—å—è –ø–æ –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏).\n"
        "‚ñ™Ô∏è –û–ø–ª–∞—Ç—É –ø–æ–ª—É—á–∞–µ—Ç–µ –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∞–≤–∫–∏ —Ç–æ–≤–∞—Ä–∞, –∏ –µ–≥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã —Ç–∞–∫ –∂–µ –≤–æ–∑–º–µ—â–∞—é—Ç –≤ –ó–ü.\n"
        "‚ñ™Ô∏è –ó–ü –Ω–∞ –±–∏—Ç–∫–æ–∏–Ω –∫–æ—à–µ–ª–µ–∫, –≤ —Å–ª—É—á–∞–µ –Ω–µ—É–º–µ–Ω–∏—è –∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.\n"
        "‚ñ™Ô∏è –ü–æ—Å–ª–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∫—É—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ–¥–µ—Ç –ø–æ–ª–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –ø–æ —Ä–∞–±–æ—Ç–µ –∏ —Ç–µ—Ö–Ω–∏–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤–∞–º –±—É–¥–µ—Ç –≤—ã–¥–∞–Ω –æ–¥–∏–Ω –æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–π —Å—Ç–∞–∂–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ä–µ–π—Å.\n\n"
        "<i>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ –∑–∞–ª–æ–≥—É –æ—Ç 60000‚ÇΩ. –î–ª—è –Ω–∞—á–∞–ª–∞ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≥–æ—Ä–æ–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.</i>"
    )
    buttons = [[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker")]]
    await _edit_vacancy_text(callback, text, buttons)

@dp.callback_query(F.data == "vac_verification")
async def vac_verification(callback: CallbackQuery):
    text = (
        "üì∞ <b>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</b> üì∞\n\n"
        "–°—É—Ç—å —Ä–∞–±–æ—Ç—ã - –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –±–∏—Ä–∂–∞—Ö\n\n"
        "‚ñ™Ô∏è –î–æ—Å—Ç—É–ø–Ω–æ –æ—Ç 2—Ö –∑–∞–¥–∞–Ω–∏–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.\n"
        "‚ñ™Ô∏è –í—ã–ø–ª–∞—Ç–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–º.\n"
        "‚ñ™Ô∏è –û–ø–ª–∞—Ç–∞ 1 –∑–∞–¥–∞–Ω–∏—è = 1000 ‚ÇΩ.\n"
        "‚ñ™Ô∏è –û–ø–ª–∞—Ç—É –∑–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∑–∞–ª–æ–≥ –¥–ª—è –¥—Ä—É–≥–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏.\n\n"
        "<i>–î–ª—è –Ω–∞—á–∞–ª–∞ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–∏—à–ª–∏—Ç–µ —Ñ–æ—Ç–æ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞—Å–ø–æ—Ä—Ç–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É. –ü—Ä–∏–º–µ—Ä:</i> <a href='https://telegra.ph/file/52e526bf246fbd07eb5e5.png'>–ø–µ—Ä–µ–π—Ç–∏</a>"
    )
    buttons = [[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker")]]
    await _edit_vacancy_text(callback, text, buttons)

@dp.callback_query(F.data == "vac_operator")
async def vac_operator(callback: CallbackQuery):
    text = (
        "üë®‚Äçüíª <b>–û–ø–µ—Ä–∞—Ç–æ—Ä</b> üë®‚Äçüíª\n\n"
        "–°—É—Ç—å —Ä–∞–±–æ—Ç—ã - –ø—Ä–∏–µ–º –æ–ø–ª–∞—Ç—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è, –≤—ã–¥–∞—á–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ–≤.\n\n"
        "‚ñ™Ô∏è –ì—Ä–∞—Ñ–∏–∫ - —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π (5/2, 2/2 –∏ —Ç.–¥. –Ω–∞ –≤–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ).\n"
        "‚ñ™Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –≤ –¥–µ–Ω—å - 4 —á–∞—Å–∞, –Ω–æ –Ω–µ –º–µ–Ω–µ–µ 30—á –≤ –Ω–µ–¥–µ–ª—é.\n"
        "‚ñ™Ô∏è –ó–ü —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç % –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ + –ø—Ä–µ–º–∏–∏.\n"
        "‚ñ™Ô∏è % –æ—Ç –ø—Ä–æ–¥–∞–∂ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫. –î–Ω–µ–≤–Ω–æ–µ –≤—Ä–µ–º—è - 5%, –Ω–æ—á–Ω–æ–µ - 10%.\n"
        "‚ñ™Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º –Ω–∞–≤—ã–∫ –±—ã—Å—Ç—Ä–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ –¥–æ–ø—É—â–µ–Ω–∏—è –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.\n\n"
        "<i>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ –∑–∞–ª–æ–≥—É –æ—Ç 5000‚ÇΩ. –î–ª—è –Ω–∞—á–∞–ª–∞ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≥–æ—Ä–æ–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.</i>"
    )
    buttons = [[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker")]]
    await _edit_vacancy_text(callback, text, buttons)

async def _edit_vacancy_text(callback, text, buttons):
    try:
        await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
            await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
            await callback.message.delete()
            photo_path = "images/work.jpg"
            if not os.path.exists(photo_path): photo_path = "images/menu.jpg"
            
            if os.path.exists(photo_path):
                 photo = FSInputFile(photo_path)
                 await callback.message.answer_photo(photo=photo, caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
            else:
                 await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()




@dp.callback_query(F.data.startswith("pay_"))
async def payment_callback(callback: CallbackQuery):
    # Format: pay_Method_Amount
    parts = callback.data.split("_")
    method = parts[1]
    raw_amount = int(parts[2])
    
    user_id = str(callback.from_user.id)
    load_data()
    # Calculate proper discounted price again to verify (or trust passed price if secure enough)
    # Using helper function to be consistent
    final_price, discount = get_discounted_price(user_id, raw_amount)
    
    amount = final_price
    
    wallet = PAYMENT_METHODS.get(method, "Error")
    
    method_names = {"BTC": "Bitcoin (BTC)", "LTC": "LiteCoin (LTC)", "Card": "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞"}
    method_name = method_names.get(method, method)
    
    text = (
        f"üí≥ <b>–û–ø–ª–∞—Ç–∞: {method_name}</b>\n\n"
        f"üí∞ –°—É–º–º–∞: <s>{raw_amount} ‚ÇΩ</s> <b>{amount} ‚ÇΩ</b>\n"
        f"{f'üéü –°–∫–∏–¥–∫–∞: {discount}%' if discount > 0 else ''}\n\n"
        f"üìã <b>–†–µ–∫–≤–∏–∑–∏—Ç—ã:</b>\n<code>{wallet}</code>\n\n"
        f"‚è∞ –£ –≤–∞—Å –µ—Å—Ç—å <b>30 –º–∏–Ω—É—Ç</b> –Ω–∞ –æ–ø–ª–∞—Ç—É.\n"
        f"–ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É'."
    )
    
    buttons = [
        [InlineKeyboardButton(text="üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É", callback_data="check_payment")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", callback_data="view_menu")]
    ]
    
    await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

@dp.callback_query(F.data == "check_payment")
async def check_payment_callback(callback: CallbackQuery):
    await callback.answer("‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é...", show_alert=False)
    # Simulate loading
    await asyncio.sleep(2)
    await callback.answer("‚ùå –û–ø–ª–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.", show_alert=True)

@dp.callback_query(F.data.startswith("view_catalog_"))
async def catalog_callback_handler(callback: CallbackQuery):
    page = int(callback.data.split("_")[-1])
    await show_catalog_page(callback, page)

@dp.callback_query(F.data.startswith("city_"))
async def city_callback(callback: CallbackQuery):
    # Extract city name (handle cities with underscores)
    city_name = callback.data[5:]  # Remove "city_" prefix
    
    if city_name not in SHOP_DATA:
        await callback.answer("‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω", show_alert=True)
        return
    
    districts = SHOP_DATA[city_name]["districts"]
    
    buttons = []
    # Districts Grid (2 per row)
    district_row = []
    for district in districts:
        status = SHOP_DATA[city_name]["coords"].get(district, "inactive")
        emoji = "‚úÖ" if status == "active" else "‚è≥"
        district_row.append(InlineKeyboardButton(
            text=f"{emoji} {district}", 
            callback_data=f"district_{city_name}_{district}"
        ))
        if len(district_row) == 2:
            buttons.append(district_row)
            district_row = []
    if district_row:
        buttons.append(district_row)
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥ –∫ –≥–æ—Ä–æ–¥–∞–º", callback_data="view_catalog_0")])
    
    text = (
        f"üèôÔ∏è <b>–ì–æ—Ä–æ–¥: {city_name}</b>\n\n"
        f"üìç –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏:"
    )
    
    photo_path = "images/catalog.jpg"
    if not os.path.exists(photo_path):
        photo_path = "images/catalog.png"
    
    try:
        if os.path.exists(photo_path):
            photo = FSInputFile(photo_path)
            await callback.message.edit_media(
                media=types.InputMediaPhoto(media=photo, caption=text),
                reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons)
            )
        else:
            await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
            await callback.message.delete()
            if os.path.exists(photo_path):
                photo = FSInputFile(photo_path)
                await callback.message.answer_photo(photo=photo, caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
            else:
                await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
            pass
    
    await callback.answer()

@dp.callback_query(F.data.startswith("district_"))
async def district_callback(callback: CallbackQuery):
    # district_City_District
    parts = callback.data.split("_", 2)
    city_name = parts[1]
    district_name = parts[2]
    
    if city_name not in SHOP_DATA or district_name not in SHOP_DATA[city_name]["districts"]:
        await callback.answer("‚ùå –†–∞–π–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω", show_alert=True)
        return
    
    buttons = []
    # Categories
    for cat_key, cat_name in CATEGORIES.items():
        buttons.append([InlineKeyboardButton(
            text=cat_name,
            callback_data=f"cat_{city_name}_{district_name}_{cat_key}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"city_{city_name}")])
    
    text = (
        f"üèôÔ∏è <b>–ì–æ—Ä–æ–¥:</b> {city_name}\n"
        f"üìç <b>–†–∞–π–æ–Ω:</b> {district_name}\n\n"
        f"üìÇ <b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–æ–≤:</b>"
    )
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
            await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
            try:
                await callback.message.delete()
                await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
            except:
                pass
    
    await callback.answer()

@dp.callback_query(F.data.startswith("cat_"))
async def category_callback(callback: CallbackQuery):
    # cat_City_District_Category
    parts = callback.data.split("_", 3)
    city_name = parts[1]
    district_name = parts[2]
    cat_key = parts[3]
    
    if cat_key not in PRODUCTS:
        await callback.answer("‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", show_alert=True)
        return
    
    products = PRODUCTS[cat_key]
    cat_name = CATEGORIES.get(cat_key, cat_key)
    
    buttons = []
    # Products list
    for idx, product in enumerate(products):
        # –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–º–º–æ–≤–∫—É –≤ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        weight = product.get('weight', '')
        buttons.append([InlineKeyboardButton(
            text=f"{product['name']} ({weight}) - {product['price']}‚ÇΩ",
            callback_data=f"prod_{city_name}_{district_name}_{cat_key}_{idx}"
        )])
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=f"district_{city_name}_{district_name}")])
    
    text = (
        f"üèôÔ∏è <b>–ì–æ—Ä–æ–¥:</b> {city_name}\n"
        f"üìç <b>–†–∞–π–æ–Ω:</b> {district_name}\n"
        f"üìÇ <b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {cat_name}\n\n"
        f"üõçÔ∏è <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä:</b>"
    )
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
            await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
            try:
                await callback.message.delete()
                await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
            except:
                pass
    
    await callback.answer()

@dp.callback_query(F.data == "ignore")
async def ignore_callback(callback: CallbackQuery):
    await callback.answer()

@dp.callback_query(F.data == "view_info")
async def info_callback(callback: CallbackQuery):
    text = (
        "‚ÑπÔ∏è <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–µ</b> ‚ÑπÔ∏è\n\n"
        "‚ú® –ú—ã - –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤ —Å –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã –±–æ–ª–µ–µ 5 –ª–µ—Ç.\n"
        "‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫.\n\n"
        "üöö <b>–î–æ—Å—Ç–∞–≤–∫–∞:</b>\n"
        "‚Ä¢ –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º –∫—Ä—É–ø–Ω—ã–º –≥–æ—Ä–æ–¥–∞–º –†–§\n"
        "‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: 2 —á–∞—Å–∞\n"
        "‚Ä¢ –†–∞–±–æ—Ç–∞–µ–º 24/7 –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö\n\n"
        "üõ°Ô∏è <b>–ì–∞—Ä–∞–Ω—Ç–∏–∏:</b>\n"
        "‚Ä¢ –ï—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞—à–ª–∏ –∫–ª–∞–¥ - –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–∑–∞–∫–ª–∞–¥ –±–µ—Å–ø–ª–∞—Ç–Ω–æ\n"
        "‚Ä¢ –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–∞–µ—Ç—Å—è –≤ –≤–∞—à—É –ø–æ–ª—å–∑—É\n\n"
        "‚≠ê <b>–û—Ç–∑—ã–≤—ã:</b> @DecepSupport"
    )
    buttons = [[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="view_menu")]]
    
    try:
         await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
         try:
             await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
         except:
             await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

@dp.callback_query(F.data == "history")
async def history_callback(callback: CallbackQuery):
    await callback.answer("üì¶ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –ø—É—Å—Ç–∞. –°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑!", show_alert=True)

@dp.callback_query(F.data == "view_delivery")
async def delivery_callback(callback: CallbackQuery):
    await callback.answer("üöö –î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ. –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: 2 —á–∞—Å–∞.", show_alert=True)

@dp.callback_query(F.data == "view_favorites")
async def favorites_callback(callback: CallbackQuery):
    user_id = str(callback.from_user.id)
    load_data()
    
    if user_id not in shop_users:
        shop_users[user_id] = {"favorites": []}
        save_shop_users()
    
    favorites = shop_users.get(user_id, {}).get("favorites", [])
    
    if not favorites:
        await callback.answer("‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞!", show_alert=True)
        return
    
    buttons = []
    text = "‚≠ê <b>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</b> ‚≠ê\n\n"
    
    # Group favorites by category for better display
    for idx, fav_key in enumerate(favorites, 1):
        # Use ||| as separator (won't appear in city/district names)
        parts = fav_key.split("|||")
        if len(parts) < 4:
            continue
            
        city_name = parts[0]
        district_name = parts[1]
        cat_key = parts[2]
        prod_idx = int(parts[3])
        
        if cat_key not in PRODUCTS or prod_idx >= len(PRODUCTS[cat_key]):
            continue
        
        product = PRODUCTS[cat_key][prod_idx]
        cat_name = CATEGORIES.get(cat_key, cat_key)
        
        # Calculate price with discount
        final_price, discount = get_discounted_price(callback.from_user.id, product['price'])
        price_str = f"{final_price}‚ÇΩ" if discount > 0 else f"{product['price']}‚ÇΩ"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–º–º–æ–≤–∫—É –≤ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        weight = product.get('weight', '')
        buttons.append([InlineKeyboardButton(
            text=f"{product['name']} ({weight}) - {price_str}",
            callback_data=f"prod_{fav_key}"
        )])
    
    if not buttons:
        await callback.answer("‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞!", show_alert=True)
        return
    
    buttons.append([InlineKeyboardButton(text="üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ", callback_data="clear_favorites")])
    buttons.append([InlineKeyboardButton(text="üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="view_menu")])
    
    text += f"üì¶ –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(buttons) - 2}\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:"
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        try:
            await callback.message.edit_caption(caption=text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
        except:
            try:
                await callback.message.delete()
                await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
            except:
                pass
    
    await callback.answer()

@dp.callback_query(F.data == "clear_favorites")
async def clear_favorites_callback(callback: CallbackQuery):
    user_id = str(callback.from_user.id)
    load_data()
    
    if user_id in shop_users:
        shop_users[user_id]["favorites"] = []
        save_shop_users()
        await callback.answer("üóëÔ∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –æ—á–∏—â–µ–Ω–æ", show_alert=False)
        await favorites_callback(callback)
    else:
        await callback.answer("‚ùå –û—à–∏–±–∫–∞", show_alert=True)

@dp.callback_query(F.data == "view_recent")
async def recent_callback(callback: CallbackQuery):
    await callback.answer("üïê –ù–µ–¥–∞–≤–Ω–∏–µ —Ç–æ–≤–∞—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞—Ç–∞–ª–æ–≥!", show_alert=True)

# --- WORKER PANEL HANDLERS ---

@dp.callback_query(F.data == "worker_startcodes")
async def worker_startcodes_handler(callback: CallbackQuery):
    load_data()
    amount = worker_data.get("startcode_amount", 100)
    
    text = f"‚≠ê <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞–º–∏</b>\n\nüí∞ –¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞: <b>{amount} ‚ÇΩ</b>"
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Å—É–º–º—É —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞", callback_data="worker_change_startcode")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_panel")]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

@dp.callback_query(F.data == "worker_change_startcode")
async def worker_change_startcode_handler(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("üí∞ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Å—É–º–º—É —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞ (—á–∏—Å–ª–æ):")
    await state.set_state(WorkerStartCodeState.waiting_for_amount)
    await callback.answer()

@dp.message(WorkerStartCodeState.waiting_for_amount)
async def process_startcode_amount(message: Message, state: FSMContext):
    if not message.text or not message.text.isdigit():
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")
        return
    
    amount = int(message.text)
    load_data()
    worker_data["startcode_amount"] = amount
    save_worker_data()
    
    await message.answer(f"‚úÖ –°—É–º–º–∞ —Å—Ç–∞—Ä—Ç–∫–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ {amount} ‚ÇΩ")
    await state.clear()

@dp.callback_query(F.data == "worker_add_purchase")
async def worker_add_purchase_handler(callback: CallbackQuery, state: FSMContext):
    text = "üõí <b>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É –≤ –∏—Å—Ç–æ—Ä–∏—é</b>\n\n–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä–∞–º–º —Ç–æ–≤–∞—Ä–∞ (–ª—é–±–æ–µ —á–∏—Å–ª–æ):"
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_panel")]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    
    await state.set_state(WorkerPurchaseState.waiting_for_grams)
    await callback.answer()

@dp.message(WorkerPurchaseState.waiting_for_grams)
async def process_purchase_grams(message: Message, state: FSMContext):
    try:
        grams = float(message.text.replace(',', '.'))
    except:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")
        return
    
    await state.update_data(grams=grams)
    await message.answer("üì¶ –í–≤–µ–¥–∏—Ç–µ —Ç–∏–ø –∫–ª–∞–¥–∞ (–ø—Ä–∏–∫–æ–ø/–º–∞–≥–Ω–∏—Ç/—Ç–∞–π–Ω–∏–∫):")
    await state.set_state(WorkerPurchaseState.waiting_for_type)

@dp.message(WorkerPurchaseState.waiting_for_type)
async def process_purchase_type(message: Message, state: FSMContext):
    if not message.text:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–∏–ø –ø–æ–∫—É–ø–∫–∏!")
        return
    p_type = message.text.strip().lower()
    if p_type not in ["–ø—Ä–∏–∫–æ–ø", "–º–∞–≥–Ω–∏—Ç", "—Ç–∞–π–Ω–∏–∫"]:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ: –ø—Ä–∏–∫–æ–ø, –º–∞–≥–Ω–∏—Ç –∏–ª–∏ —Ç–∞–π–Ω–∏–∫")
        return
    
    await state.update_data(p_type=p_type)
    await message.answer("üìÖ –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: 22.07.2024):")
    await state.set_state(WorkerPurchaseState.waiting_for_date)

@dp.message(WorkerPurchaseState.waiting_for_date)
async def process_purchase_date(message: Message, state: FSMContext):
    if not message.text:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É!")
        return
    date = message.text.strip()
    await state.update_data(date=date)
    await message.answer("üìù –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:")
    await state.set_state(WorkerPurchaseState.waiting_for_name)

@dp.message(WorkerPurchaseState.waiting_for_name)
async def process_purchase_name(message: Message, state: FSMContext):
    if not message.text:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞!")
        return
    name = message.text.strip()
    data = await state.get_data()
    
    grams = data.get("grams")
    p_type = data.get("p_type")
    date = data.get("date")
    
    text = (
        f"<b>–í–∞—à–∞ –ø–æ–∫—É–ø–∫–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:</b>\n\n"
        f"üõí {date} - {name} | {grams}–≥ | {p_type}"
    )
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚úÖ –î–æ–±–∞–≤–∏—Ç—å", callback_data="worker_confirm_purchase")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="worker_panel")]
    ])
    
    await state.update_data(name=name)
    await message.answer(text, reply_markup=keyboard)

@dp.callback_query(F.data == "worker_confirm_purchase")
async def worker_confirm_purchase_handler(callback: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    
    load_data()
    purchase = {
        "date": data.get("date"),
        "name": data.get("name"),
        "grams": data.get("grams"),
        "type": data.get("p_type")
    }
    worker_data["purchases"].append(purchase)
    save_worker_data()
    
    await callback.answer("‚úÖ –ü–æ–∫—É–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é!", show_alert=True)
    await state.clear()
    
    # Return to worker panel
    await worker_panel_callback(callback)

@dp.callback_query(F.data == "worker_delete_purchases")
async def worker_delete_purchases_handler(callback: CallbackQuery):
    text = "üóëÔ∏è <b>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏?</b>\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!"
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å", callback_data="worker_confirm_delete_purchases")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_panel")]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

@dp.callback_query(F.data == "worker_confirm_delete_purchases")
async def worker_confirm_delete_purchases_handler(callback: CallbackQuery):
    load_data()
    worker_data["purchases"] = []
    save_worker_data()
    
    await callback.answer("‚úÖ –í—Å–µ –ø–æ–∫—É–ø–∫–∏ —É–¥–∞–ª–µ–Ω—ã!", show_alert=True)
    await worker_panel_callback(callback)

@dp.callback_query(F.data == "worker_link_mammoth")
async def worker_link_mammoth_handler(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("üîó –í–≤–µ–¥–∏—Ç–µ ID –º–∞–º–æ–Ω—Ç–∞ –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏:")
    await state.set_state(WorkerLinkMammothState.waiting_for_id)
    await callback.answer()

@dp.message(WorkerLinkMammothState.waiting_for_id)
async def process_link_mammoth(message: Message, state: FSMContext):
    if not message.text:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ ID –º–∞–º–æ–Ω—Ç–∞!")
        await state.clear()
        return
    
    mammoth_id = str(message.text.strip())
    
    if not mammoth_id.isdigit():
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ–≤–æ–π ID!")
        return
    
    worker_id = str(message.from_user.id)
    load_data()
    
    if mammoth_id not in shop_users:
        await message.answer("‚ùå –ú–∞–º–æ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!")
        await state.clear()
        return
    
    shop_users[mammoth_id]["referrer_id"] = worker_id
    save_shop_users()
    
    await message.answer(f"‚úÖ –ú–∞–º–æ–Ω—Ç {mammoth_id} —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!")
    await state.clear()

@dp.callback_query(F.data == "worker_broadcast")
async def worker_broadcast_handler(callback: CallbackQuery, state: FSMContext):
    worker_id = str(callback.from_user.id)
    username = callback.from_user.username or "Unknown"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(worker_id):
        log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞—Å—Å—ã–ª–∫–µ")
        await callback.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.", show_alert=True)
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit
    if not check_rate_limit(worker_id, "BROADCAST"):
        log_security_event("RATE_LIMIT_EXCEEDED", worker_id, username, f"–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ä–∞—Å—Å—ã–ª–æ–∫ ({MAX_BROADCAST_PER_HOUR}/—á–∞—Å)")
        await callback.answer(f"‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ä–∞—Å—Å—ã–ª–æ–∫. –ú–∞–∫—Å–∏–º—É–º {MAX_BROADCAST_PER_HOUR} –≤ —á–∞—Å.", show_alert=True)
        return
    
    load_data()
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–∞–º–æ–Ω—Ç–æ–≤ –≤–æ—Ä–∫–µ—Ä–∞
    mammoths = []
    for uid, data in shop_users.items():
        if str(data.get("referrer_id")) == worker_id:
            username = data.get("username", "Unknown")
            mammoths.append((uid, username))
    
    if not mammoths:
        await callback.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –º–∞–º–æ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏!", show_alert=True)
        return
    
    # –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
    text = "üì¢ <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏:</b>\n\n"
    text += "‚Ä¢ <b>–í—Å–µ–º –º–∞–º–æ–Ω—Ç–∞–º</b> - —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º –º–∞–º–æ–Ω—Ç–∞–º\n"
    text += "‚Ä¢ <b>–í—ã–±—Ä–∞—Ç—å –º–∞–º–æ–Ω—Ç–∞</b> - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–∞–º–æ–Ω—Ç—É"
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üì¢ –í—Å–µ–º –º–∞–º–æ–Ω—Ç–∞–º", callback_data="broadcast_all")],
        [InlineKeyboardButton(text="üë§ –í—ã–±—Ä–∞—Ç—å –º–∞–º–æ–Ω—Ç–∞", callback_data="broadcast_select")],
        [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="close_panel")]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

@dp.callback_query(F.data == "broadcast_all")
async def broadcast_all_handler(callback: CallbackQuery, state: FSMContext):
    await state.update_data(broadcast_type="all")
    await callback.message.answer("üì¢ –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –≤—Å–µ–º –º–∞–º–æ–Ω—Ç–∞–º:")
    await state.set_state(WorkerBroadcastState.waiting_for_message)
    await callback.answer()

@dp.callback_query(F.data == "broadcast_select")
async def broadcast_select_handler(callback: CallbackQuery, state: FSMContext):
    worker_id = str(callback.from_user.id)
    load_data()
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–∞–º–æ–Ω—Ç–æ–≤ –≤–æ—Ä–∫–µ—Ä–∞
    mammoths = []
    for uid, data in shop_users.items():
        if str(data.get("referrer_id")) == worker_id:
            username = data.get("username", "Unknown")
            balance = data.get("balance", 0)
            mammoths.append((uid, username, balance))
    
    if not mammoths:
        await callback.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –º–∞–º–æ–Ω—Ç–æ–≤!", show_alert=True)
        return
    
    await state.update_data(broadcast_type="select")
    
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å–æ —Å–ø–∏—Å–∫–æ–º –º–∞–º–æ–Ω—Ç–æ–≤
    keyboard_buttons = []
    for uid, username, balance in mammoths:
        button_text = f"üë§ @{username} (ID: {uid})"
        keyboard_buttons.append([InlineKeyboardButton(
            text=button_text,
            callback_data=f"broadcast_to_{uid}"
        )])
    
    keyboard_buttons.append([InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="close_panel")])
    keyboard = InlineKeyboardMarkup(inline_keyboard=keyboard_buttons)
    
    text = "üë§ <b>–í—ã–±–µ—Ä–∏—Ç–µ –º–∞–º–æ–Ω—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:</b>\n\n"
    text += f"–í—Å–µ–≥–æ –º–∞–º–æ–Ω—Ç–æ–≤: {len(mammoths)}"
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

@dp.callback_query(F.data.startswith("broadcast_to_"))
async def broadcast_to_mammoth_handler(callback: CallbackQuery, state: FSMContext):
    target_id = str(callback.data.split("_")[2])
    await state.update_data(target_mammoth_id=target_id)
    
    load_data()
    mammoth_data = shop_users.get(target_id, {})
    username = mammoth_data.get("username", "Unknown")
    
    await callback.message.answer(f"üì¢ –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –º–∞–º–æ–Ω—Ç–∞ @{username} (ID: {target_id}):")
    await state.set_state(WorkerBroadcastState.waiting_for_message)
    await callback.answer()

@dp.message(WorkerBroadcastState.waiting_for_message)
async def process_broadcast(message: Message, state: FSMContext):
    if not message.text:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è!")
        return
    
    worker_id = str(message.from_user.id)
    username = message.from_user.username or "Unknown"
    broadcast_text = message.text
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if not is_worker_authorized(worker_id):
        log_security_event("UNAUTHORIZED_ACCESS", worker_id, username, "–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏")
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.")
        await state.clear()
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–∞–º
    if check_spam_content(broadcast_text):
        log_security_event("SPAM_DETECTED", worker_id, username, f"–û–±–Ω–∞—Ä—É–∂–µ–Ω —Å–ø–∞–º –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏: {broadcast_text[:100]}")
        await message.answer("‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞.")
        await state.clear()
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è
    if len(broadcast_text) > MAX_MESSAGE_LENGTH:
        await message.answer(f"‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ. –ú–∞–∫—Å–∏–º—É–º {MAX_MESSAGE_LENGTH} —Å–∏–º–≤–æ–ª–æ–≤.")
        await state.clear()
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit
    if not check_rate_limit(worker_id, "BROADCAST"):
        log_security_event("RATE_LIMIT_EXCEEDED", worker_id, username, f"–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ä–∞—Å—Å—ã–ª–æ–∫ ({MAX_BROADCAST_PER_HOUR}/—á–∞—Å)")
        await message.answer(f"‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ä–∞—Å—Å—ã–ª–æ–∫. –ú–∞–∫—Å–∏–º—É–º {MAX_BROADCAST_PER_HOUR} –≤ —á–∞—Å.")
        await state.clear()
        return
    
    data = await state.get_data()
    broadcast_type = data.get("broadcast_type", "all")
    
    # –õ–æ–≥–∏—Ä—É–µ–º —Ä–∞—Å—Å—ã–ª–∫—É
    log_security_event("BROADCAST", worker_id, username, f"–¢–∏–ø: {broadcast_type}, –î–ª–∏–Ω–∞: {len(broadcast_text)}")
    
    load_data()
    
    success = 0
    failed = 0
    
    if broadcast_type == "all":
        # –†–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –º–∞–º–æ–Ω—Ç–∞–º
        mammoths = []
        for uid, user_data in shop_users.items():
            if str(user_data.get("referrer_id")) == worker_id:
                mammoths.append(uid)
        
        if not mammoths:
            await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –º–∞–º–æ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏!")
            await state.clear()
            return
        
        for mammoth_id in mammoths:
            try:
                await bot.send_message(chat_id=int(mammoth_id), text=broadcast_text)
                success += 1
            except (TelegramForbiddenError, TelegramBadRequest):
                # –ú–∞–º–æ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
                load_data()
                mammoth_username = shop_users.get(mammoth_id, {}).get("username")
                await notify_worker_mammoth_blocked(mammoth_id, mammoth_username)
                failed += 1
            except Exception as e:
                logging.error(f"Error sending broadcast to {mammoth_id}: {e}")
                failed += 1
        
        await message.answer(f"‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n–£—Å–ø–µ—à–Ω–æ: {success}\n–û—à–∏–±–æ–∫: {failed}")
    
    elif broadcast_type == "select":
        # –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–∞–º–æ–Ω—Ç—É
        target_id = data.get("target_mammoth_id")
        if not target_id:
            await message.answer("‚ùå –û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω ID –º–∞–º–æ–Ω—Ç–∞")
            await state.clear()
            return
        
        target_id = str(target_id)
        load_data()
        
        if target_id not in shop_users:
            await message.answer("‚ùå –ú–∞–º–æ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!")
            await state.clear()
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –º–∞–º–æ–Ω—Ç –≤–æ—Ä–∫–µ—Ä–∞
        mammoth_data = shop_users[target_id]
        if str(mammoth_data.get("referrer_id")) != worker_id:
            await message.answer("‚ùå –≠—Ç–æ –Ω–µ –≤–∞—à –º–∞–º–æ–Ω—Ç!")
            await state.clear()
            return
        
        try:
            await bot.send_message(chat_id=int(target_id), text=broadcast_text)
            username = mammoth_data.get("username", "Unknown")
            await message.answer(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –º–∞–º–æ–Ω—Ç—É @{username} (ID: {target_id})")
            success = 1
        except (TelegramForbiddenError, TelegramBadRequest):
            mammoth_username = mammoth_data.get("username")
            await notify_worker_mammoth_blocked(target_id, mammoth_username)
            await message.answer(f"‚ùå –ú–∞–º–æ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞. –í–æ—Ä–∫–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω.")
            failed = 1
        except Exception as e:
            logging.error(f"Error sending message to {target_id}: {e}")
            await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
            failed = 1
    
    await state.clear()

@dp.callback_query(F.data == "worker_cities")
async def worker_cities_handler(callback: CallbackQuery):
    cities = list(SHOP_DATA.keys())
    
    buttons = []
    # Cities in 2 columns
    city_row = []
    for city in cities:
        city_row.append(InlineKeyboardButton(text=f"üèôÔ∏è {city}", callback_data=f"worker_city_{city}"))
        if len(city_row) == 2:
            buttons.append(city_row)
            city_row = []
    if city_row:
        buttons.append(city_row)
    
    buttons.append([InlineKeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥", callback_data="worker_add_city")])
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_panel")])
    
    text = "üèôÔ∏è <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

@dp.callback_query(F.data.startswith("worker_city_"))
async def worker_city_edit_handler(callback: CallbackQuery):
    city_name = callback.data.replace("worker_city_", "", 1)
    
    text = f"üèôÔ∏è <b>–ì–æ—Ä–æ–¥: {city_name}</b>\n\n–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?"
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≥–æ—Ä–æ–¥", callback_data=f"worker_delete_city_{city_name}")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_cities")]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

@dp.callback_query(F.data.startswith("worker_delete_city_"))
async def worker_delete_city_handler(callback: CallbackQuery):
    city_name = callback.data.replace("worker_delete_city_", "", 1)
    
    if city_name in SHOP_DATA:
        del SHOP_DATA[city_name]
        await callback.answer(f"‚úÖ –ì–æ—Ä–æ–¥ {city_name} —É–¥–∞–ª–µ–Ω!", show_alert=True)
        await worker_cities_handler(callback)
    else:
        await callback.answer("‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω!", show_alert=True)

@dp.callback_query(F.data == "worker_add_city")
async def worker_add_city_handler(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("üèôÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞:")
    await state.set_state(WorkerCityState.waiting_for_city_name)
    await callback.answer()

@dp.message(WorkerCityState.waiting_for_city_name)
async def process_add_city(message: Message, state: FSMContext):
    city_name = message.text.strip()
    
    if city_name in SHOP_DATA:
        await message.answer("‚ùå –¢–∞–∫–æ–π –≥–æ—Ä–æ–¥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!")
        await state.clear()
        return
    
    SHOP_DATA[city_name] = {
        "districts": ["–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π"],
        "coords": {"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": "active"}
    }
    
    await message.answer(f"‚úÖ –ì–æ—Ä–æ–¥ {city_name} –¥–æ–±–∞–≤–ª–µ–Ω!")
    await state.clear()

@dp.callback_query(F.data == "worker_districts")
async def worker_districts_handler(callback: CallbackQuery, state: FSMContext):
    cities = list(SHOP_DATA.keys())
    
    buttons = []
    city_row = []
    for city in cities:
        city_row.append(InlineKeyboardButton(text=f"üèôÔ∏è {city}", callback_data=f"worker_district_city_{city}"))
        if len(city_row) == 2:
            buttons.append(city_row)
            city_row = []
    if city_row:
        buttons.append(city_row)
    
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_panel")])
    
    text = "üìç <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–π–æ–Ω–æ–≤</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥:"
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

@dp.callback_query(F.data.startswith("worker_district_city_"))
async def worker_district_city_handler(callback: CallbackQuery, state: FSMContext):
    city_name = callback.data.replace("worker_district_city_", "", 1)
    
    if city_name not in SHOP_DATA:
        await callback.answer("‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω!", show_alert=True)
        return
    
    districts = SHOP_DATA[city_name]["districts"]
    
    buttons = []
    for district in districts:
        buttons.append([InlineKeyboardButton(text=f"üìç {district}", callback_data=f"worker_district_edit_{city_name}_{district}")])
    
    buttons.append([InlineKeyboardButton(text="‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–π–æ–Ω", callback_data=f"worker_add_district_{city_name}")])
    buttons.append([InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_districts")])
    
    text = f"üìç <b>–†–∞–π–æ–Ω—ã –≥–æ—Ä–æ–¥–∞ {city_name}</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω:"
    
    await state.update_data(city=city_name)
    
    try:
        await callback.message.edit_text(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    except:
        await callback.message.answer(text, reply_markup=InlineKeyboardMarkup(inline_keyboard=buttons))
    await callback.answer()

@dp.callback_query(F.data.startswith("worker_add_district_"))
async def worker_add_district_handler(callback: CallbackQuery, state: FSMContext):
    city_name = callback.data.replace("worker_add_district_", "", 1)
    await state.update_data(city=city_name)
    await callback.message.answer(f"üìç –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞–π–æ–Ω–∞ –¥–ª—è –≥–æ—Ä–æ–¥–∞ {city_name}:")
    await state.set_state(WorkerDistrictState.waiting_for_district_name)
    await callback.answer()

@dp.message(WorkerDistrictState.waiting_for_district_name)
async def process_add_district(message: Message, state: FSMContext):
    district_name = message.text.strip()
    data = await state.get_data()
    city_name = data.get("city")
    
    if city_name not in SHOP_DATA:
        await message.answer("‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        await state.clear()
        return
    
    if district_name in SHOP_DATA[city_name]["districts"]:
        await message.answer("‚ùå –¢–∞–∫–æ–π —Ä–∞–π–æ–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!")
        await state.clear()
        return
    
    SHOP_DATA[city_name]["districts"].append(district_name)
    SHOP_DATA[city_name]["coords"][district_name] = "active"
    
    await message.answer(f"‚úÖ –†–∞–π–æ–Ω {district_name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥–æ—Ä–æ–¥ {city_name}!")
    await state.clear()

@dp.callback_query(F.data == "worker_products_district")
async def worker_products_district_handler(callback: CallbackQuery):
    await callback.answer("üì¶ –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ", show_alert=True)

@dp.callback_query(F.data == "worker_products")
async def worker_products_handler(callback: CallbackQuery):
    await callback.answer("üõçÔ∏è –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ", show_alert=True)

@dp.callback_query(F.data == "worker_profile")
async def worker_profile_handler(callback: CallbackQuery):
    text = "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üí∞ –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å", callback_data="worker_profile_balance")],
        [InlineKeyboardButton(text="‚öñÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª-–≤–æ –¥–∏—Å–ø—É—Ç–æ–≤", callback_data="worker_profile_disputes")],
        [InlineKeyboardButton(text="üìÖ –ò–∑–º–µ–Ω–∏—Ç—å –¥–∞—Ç—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏", callback_data="worker_profile_date")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="worker_panel")]
    ])
    
    try:
        await callback.message.edit_text(text, reply_markup=keyboard)
    except:
        await callback.message.answer(text, reply_markup=keyboard)
    await callback.answer()

@dp.callback_query(F.data == "worker_profile_balance")
async def worker_profile_balance_handler(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("üí∞ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å (—á–∏—Å–ª–æ):")
    await state.set_state(WorkerProfileState.waiting_for_balance)
    await callback.answer()

@dp.message(WorkerProfileState.waiting_for_balance)
async def process_profile_balance(message: Message, state: FSMContext):
    if not message.text or not message.text.isdigit():
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")
        return
    
    user_id = str(message.from_user.id)
    new_balance = int(message.text)
    
    load_data()
    if user_id not in shop_users:
        shop_users[user_id] = {}
    shop_users[user_id]["balance"] = new_balance
    save_shop_users()
    
    await message.answer(f"‚úÖ –ë–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ {new_balance} ‚ÇΩ")
    await state.clear()

@dp.callback_query(F.data == "worker_profile_disputes")
async def worker_profile_disputes_handler(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("‚öñÔ∏è –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏—Å–ø—É—Ç–æ–≤ (—á–∏—Å–ª–æ):")
    await state.set_state(WorkerProfileState.waiting_for_disputes)
    await callback.answer()

@dp.message(WorkerProfileState.waiting_for_disputes)
async def process_profile_disputes(message: Message, state: FSMContext):
    if not message.text or not message.text.isdigit():
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!")
        return
    
    user_id = str(message.from_user.id)
    new_disputes = int(message.text)
    
    load_data()
    if user_id not in shop_users:
        shop_users[user_id] = {}
    shop_users[user_id]["disputes"] = new_disputes
    save_shop_users()
    
    await message.answer(f"‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏—Å–ø—É—Ç–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ {new_disputes}")
    await state.clear()

@dp.callback_query(F.data == "worker_profile_date")
async def worker_profile_date_handler(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer("üìÖ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –¥–∞—Ç—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 22.07.2024):")
    await state.set_state(WorkerProfileState.waiting_for_date)
    await callback.answer()

@dp.message(WorkerProfileState.waiting_for_date)
async def process_profile_date(message: Message, state: FSMContext):
    if not message.text:
        await message.answer("‚ùå –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É!")
        return
    user_id = str(message.from_user.id)
    new_date = message.text.strip()
    
    load_data()
    if user_id not in shop_users:
        shop_users[user_id] = {}
    shop_users[user_id]["join_date"] = new_date
    save_shop_users()
    
    await message.answer(f"‚úÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ {new_date}")
    await state.clear()

@dp.callback_query(F.data == "worker_config")
async def worker_config_handler(callback: CallbackQuery):
    await callback.answer("‚öôÔ∏è –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ", show_alert=True)

# --- ADMIN SECURITY COMMANDS ---
@dp.message(Command("admin_security"))
async def admin_security_panel(message: Message):
    """–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –¥–ª—è –∞–¥–º–∏–Ω–∞"""
    user_id = str(message.from_user.id)
    
    if int(user_id) != ADMIN_ID:
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")
        return
    
    load_security_data()
    
    text = "üîí <b>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é</b>\n\n"
    text += f"üìã <b>–í–æ—Ä–∫–µ—Ä–æ–≤ –≤ whitelist:</b> {len(worker_whitelist)}\n"
    text += f"üìä <b>–°–æ–±—ã—Ç–∏–π –≤ –ª–æ–≥–µ:</b> {len(security_log)}\n\n"
    text += "<b>–ö–æ–º–∞–Ω–¥—ã:</b>\n"
    text += "/add_worker [ID] - –¥–æ–±–∞–≤–∏—Ç—å –≤–æ—Ä–∫–µ—Ä–∞ –≤ whitelist\n"
    text += "/remove_worker [ID] - —É–¥–∞–ª–∏—Ç—å –≤–æ—Ä–∫–µ—Ä–∞ –∏–∑ whitelist\n"
    text += "/list_workers - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤\n"
    text += "/security_log - –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
    
    await message.answer(text, parse_mode='HTML')

@dp.message(Command("add_worker"))
async def add_worker_command(message: Message):
    """–î–æ–±–∞–≤–∏—Ç—å –≤–æ—Ä–∫–µ—Ä–∞ –≤ whitelist"""
    user_id = str(message.from_user.id)
    
    if int(user_id) != ADMIN_ID:
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")
        return
    
    args = message.text.split()
    if len(args) < 2:
        await message.answer("‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /add_worker [ID]")
        return
    
    worker_id = str(args[1])
    load_security_data()
    
    if worker_id not in worker_whitelist:
        worker_whitelist.append(worker_id)
        save_worker_whitelist()
        log_security_event("WHITELIST_ADD", user_id, message.from_user.username or "Admin", f"–î–æ–±–∞–≤–ª–µ–Ω –≤–æ—Ä–∫–µ—Ä {worker_id}")
        await message.answer(f"‚úÖ –í–æ—Ä–∫–µ—Ä {worker_id} –¥–æ–±–∞–≤–ª–µ–Ω –≤ whitelist.")
    else:
        await message.answer(f"‚ö†Ô∏è –í–æ—Ä–∫–µ—Ä {worker_id} —É–∂–µ –≤ whitelist.")

@dp.message(Command("remove_worker"))
async def remove_worker_command(message: Message):
    """–£–¥–∞–ª–∏—Ç—å –≤–æ—Ä–∫–µ—Ä–∞ –∏–∑ whitelist"""
    user_id = str(message.from_user.id)
    
    if int(user_id) != ADMIN_ID:
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")
        return
    
    args = message.text.split()
    if len(args) < 2:
        await message.answer("‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /remove_worker [ID]")
        return
    
    worker_id = str(args[1])
    load_security_data()
    
    if worker_id in worker_whitelist:
        worker_whitelist.remove(worker_id)
        save_worker_whitelist()
        log_security_event("WHITELIST_REMOVE", user_id, message.from_user.username or "Admin", f"–£–¥–∞–ª–µ–Ω –≤–æ—Ä–∫–µ—Ä {worker_id}")
        await message.answer(f"‚úÖ –í–æ—Ä–∫–µ—Ä {worker_id} —É–¥–∞–ª–µ–Ω –∏–∑ whitelist.")
    else:
        await message.answer(f"‚ö†Ô∏è –í–æ—Ä–∫–µ—Ä {worker_id} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ whitelist.")

@dp.message(Command("list_workers"))
async def list_workers_command(message: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤ –≤ whitelist"""
    user_id = str(message.from_user.id)
    
    if int(user_id) != ADMIN_ID:
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")
        return
    
    load_security_data()
    
    text = "üìã <b>–í–æ—Ä–∫–µ—Ä—ã –≤ whitelist:</b>\n\n"
    if worker_whitelist:
        for wid in worker_whitelist:
            text += f"‚Ä¢ <code>{wid}</code>\n"
    else:
        text += "–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)"
    
    await message.answer(text, parse_mode='HTML')

@dp.message(Command("security_log"))
async def security_log_command(message: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
    user_id = str(message.from_user.id)
    
    if int(user_id) != ADMIN_ID:
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")
        return
    
    load_security_data()
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–±—ã—Ç–∏–π
    recent_events = security_log[-10:] if len(security_log) > 10 else security_log
    recent_events.reverse()
    
    text = "üìä <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</b>\n\n"
    if recent_events:
        for event in recent_events:
            text += f"<b>{event.get('type', 'UNKNOWN')}</b>\n"
            text += f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @{event.get('username', 'Unknown')} (ID: {event.get('user_id', 'N/A')})\n"
            text += f"–í—Ä–µ–º—è: {event.get('timestamp', 'N/A')}\n"
            text += f"–î–µ—Ç–∞–ª–∏: {event.get('details', 'N/A')[:50]}...\n\n"
    else:
        text += "–°–æ–±—ã—Ç–∏–π –Ω–µ—Ç"
    
    await message.answer(text, parse_mode='HTML')

async def main():
    global bot
    bot = Bot(token=TOKEN, default=DefaultBotProperties(parse_mode=ParseMode.HTML))
    await bot.delete_webhook(drop_pending_updates=True)
    await dp.start_polling(bot)

if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO, stream=sys.stdout)
    asyncio.run(main())
